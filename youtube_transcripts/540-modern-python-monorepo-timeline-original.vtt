WEBVTT

00:00:00.639 --> 00:00:06.800
<v Michael Kennedy>Hello, hello, Jarek, Amogh. Welcome to Talk Python To Me. Awesome to have Amogh, you here,

00:00:07.260 --> 00:00:14.900
<v Jarek Potiuk>and Jarek, you back. Yep. Welcome. Very nice to be again at Talk Python To Me. That's one of my

00:00:15.170 --> 00:00:21.480
<v Jarek Potiuk>favorite podcasts I listen to all the time. Thank you. Thank you. It's my first, but yeah,

00:00:22.260 --> 00:00:27.080
<v Amogh Desai>thanks for having me here, Michael. Yeah. Happy to have you here. You all have built,

00:00:27.720 --> 00:00:35.760
<v Michael Kennedy>You and a team of people, given the scale of this project, have built an amazing product with Apache Airflow.

00:00:37.240 --> 00:00:38.960
<v Michael Kennedy>It's going to be really fun to dive into it.

00:00:38.980 --> 00:00:46.480
<v Michael Kennedy>And specifically, we're going to focus on not building workflows exactly, although I'm sure we'll talk about that somewhat.

00:00:47.140 --> 00:00:53.400
<v Michael Kennedy>The real goal, the thing that we're going to focus on is how do you manage such a big project

00:00:53.640 --> 00:00:57.600
<v Michael Kennedy>with so many different little inner internal packages

00:00:57.940 --> 00:00:59.720
<v Michael Kennedy>that all depend upon each other and so on.

00:01:00.500 --> 00:01:02.300
<v Michael Kennedy>And monorepos and that.

00:01:02.520 --> 00:01:06.280
<v Michael Kennedy>I've touched on monorepos before, but two things.

00:01:06.340 --> 00:01:08.300
<v Michael Kennedy>I think this makes a really interesting discussion

00:01:08.520 --> 00:01:09.640
<v Michael Kennedy>for listeners out there.

00:01:09.960 --> 00:01:14.140
<v Michael Kennedy>One, this is going to be very concrete with exact steps.

00:01:14.700 --> 00:01:15.420
<v Michael Kennedy>And it's even open source.

00:01:15.560 --> 00:01:17.280
<v Michael Kennedy>You can go check it out and play with it.

00:01:17.800 --> 00:01:21.740
<v Michael Kennedy>And two, the tooling and the standards

00:01:21.880 --> 00:01:23.160
<v Michael Kennedy>have changed significantly.

00:01:23.180 --> 00:01:25.060
<v Michael Kennedy>since I talked about this three or four years ago,

00:01:25.300 --> 00:01:27.360
<v Michael Kennedy>making much of what we're going to talk about possible, right?

00:01:28.840 --> 00:01:29.640
<v Jarek Potiuk>Yes, absolutely.

00:01:30.500 --> 00:01:30.580
<v Michael Kennedy>Yeah.

00:01:31.580 --> 00:01:33.300
<v Michael Kennedy>Now, before we dive into that, of course,

00:01:34.260 --> 00:01:35.820
<v Michael Kennedy>let's do quick introductions.

00:01:36.740 --> 00:01:38.220
<v Michael Kennedy>Jarek, it's been a while since you've been on the show.

00:01:38.220 --> 00:01:38.640
<v Michael Kennedy>Who are you?

00:01:38.920 --> 00:01:39.640
<v Michael Kennedy>Tell people who you are.

00:01:40.920 --> 00:01:43.340
<v Jarek Potiuk>I'm an Apache Airflow maintainer,

00:01:43.380 --> 00:01:45.420
<v Jarek Potiuk>one of the PMC members as well,

00:01:45.600 --> 00:01:48.960
<v Jarek Potiuk>and also one of the Apache Software Foundation members.

00:01:49.120 --> 00:01:51.920
<v Jarek Potiuk>I've got this nice pin, new logo of Apache Software Foundation

00:01:51.940 --> 00:02:00.940
<v Jarek Potiuk>that we got at FOSDEM. I'm also an Apache Airflow security committee member, which is an important

00:02:01.190 --> 00:02:06.140
<v Jarek Potiuk>aspect for what we are discussing today because of supply chain and dependencies and

00:02:08.460 --> 00:02:15.100
<v Jarek Potiuk>lots of security potential potential security issues these dependencies bring. Yeah, I'm one of

00:02:15.100 --> 00:02:20.800
<v Jarek Potiuk>the few lucky people to get to contribute to open source full time and get paid for it, which is like

00:02:20.880 --> 00:02:26.500
<v Jarek Potiuk>amazing. Maybe another podcast one day about that because I think that's also an interesting one.

00:02:26.800 --> 00:02:30.700
<v Michael Kennedy>Yeah, I have something like that, a topic somewhat like that brewing. So yeah, potentially,

00:02:31.239 --> 00:02:34.920
<v Michael Kennedy>I'll have to have you back for that. Amok?

00:02:35.850 --> 00:02:41.860
<v Amogh Desai>Yep. So, hey, I'm Amok Desai. Again, similar to Jarek, I'm a PMC member and

00:02:42.420 --> 00:02:51.200
<v Amogh Desai>computer at Apache airflow. And I'm also a part of, I'm one of the top 10 contributors to the project,

00:02:51.760 --> 00:02:54.400
<v Amogh Desai>top 10 all time contributors to the project, Jarek being number one.

00:02:57.100 --> 00:03:03.040
<v Amogh Desai>So I work at Astronomer as a senior software engineer, where I get to live in both worlds.

00:03:03.500 --> 00:03:10.080
<v Amogh Desai>One is contributing to airflow score development, and also supporting the companies that are trying

00:03:10.020 --> 00:03:17.540
<v Michael Kennedy>to run air flow at scale right awesome what is astronomer tell people about that yeah it's a

00:03:17.760 --> 00:03:23.480
<v Amogh Desai>it's a company where most of our uh we're a company which is almost one of the leading

00:03:23.920 --> 00:03:29.760
<v Amogh Desai>contributors to apache airflow and also the leading consumer of it we supply uh and we provide a

00:03:29.860 --> 00:03:35.680
<v Amogh Desai>managed distribution of uh corporate managed distribution of apache airflow inside astro

00:03:36.680 --> 00:03:44.380
<v Amogh Desai>and yeah i think we have a data platform as well to try and make your life easier to use airflow at

00:03:44.460 --> 00:03:50.980
<v Jarek Potiuk>scale yeah incredible let me add to it two comments so as airflow has a number of stakeholders and the

00:03:51.760 --> 00:03:57.040
<v Jarek Potiuk>commercial stakeholders who are hosting airflow as a service as well and you know like using airflow

00:03:57.420 --> 00:04:01.939
<v Jarek Potiuk>and we have contributed contributions from all over the place astronomer by far like the biggest

00:04:01.860 --> 00:04:08.020
<v Jarek Potiuk>number of contributions and fantastic open source stakeholder. We were very much focused on making

00:04:08.060 --> 00:04:15.340
<v Jarek Potiuk>Apache Airflow truly vendor-neutral Apache project. I'm always amazed how well this works.

00:04:16.560 --> 00:04:22.740
<v Jarek Potiuk>And the second thing, the number one, I'm cheating a bit. I do a lot of small PRs. This is how you get

00:04:22.740 --> 00:04:31.820
<v Michael Kennedy>the number one. I guess it depends how you measure it. You could always just do one ginormous AI

00:04:32.380 --> 00:04:36.600
<v Michael Kennedy>PR that's like 100,000 lines of code in your PR and people would love you for it.

00:04:36.640 --> 00:04:37.940
<v Michael Kennedy>You'd be a mega contributor.

00:04:38.560 --> 00:04:39.680
<v Michael Kennedy>Oh, yeah.

00:04:40.180 --> 00:04:40.500
<v Amogh Desai>Well, no.

00:04:40.920 --> 00:04:40.980
<v Amogh Desai>No.

00:04:40.980 --> 00:04:41.460
<v Amogh Desai>He does both.

00:04:42.100 --> 00:04:42.460
<v Amogh Desai>Well, no.

00:04:43.340 --> 00:04:44.820
<v Amogh Desai>The funny part is Jarek does both.

00:04:45.140 --> 00:04:48.460
<v Amogh Desai>It's his velocity amazes me or, I don't know, shocks me sometimes.

00:04:49.360 --> 00:04:53.420
<v Amogh Desai>He does massive PRs and also like a lot of tiny ones.

00:04:53.520 --> 00:04:55.900
<v Amogh Desai>And by the time I'm looking, there are like three more out of it.

00:04:55.940 --> 00:04:56.780
<v Amogh Desai>I don't know how he does it.

00:04:57.800 --> 00:05:05.040
<v Michael Kennedy>Yeah, we're going to get to a bit of how much traffic there is on Airflow in terms of like open source activity.

00:05:06.320 --> 00:05:07.520
<v Michael Kennedy>It's some, it's a little bit.

00:05:09.940 --> 00:05:14.240
<v Michael Kennedy>Before we move on though, Jarek, what is the Apache Software Foundation?

00:05:14.340 --> 00:05:19.680
<v Michael Kennedy>What is this Apache thing that you're just talking about and why is Airflow part of it?

00:05:20.220 --> 00:05:24.660
<v Jarek Potiuk>Okay, so very quickly, it's a foundation, one of the oldest foundations, open source foundation in the world.

00:05:25.560 --> 00:05:28.040
<v Jarek Potiuk>25, 26, seven years now, I think.

00:05:29.400 --> 00:05:31.760
<v Jarek Potiuk>The main thing about Apache Software Foundation

00:05:31.760 --> 00:05:33.120
<v Jarek Potiuk>is that it's individual driven.

00:05:33.960 --> 00:05:36.200
<v Jarek Potiuk>So every member is an individual, not a corporate,

00:05:36.720 --> 00:05:38.160
<v Jarek Potiuk>as opposed to like Linux Software Foundation

00:05:38.360 --> 00:05:39.760
<v Jarek Potiuk>where members are corporates.

00:05:40.560 --> 00:05:43.920
<v Jarek Potiuk>And people make decisions in both foundation and projects

00:05:44.960 --> 00:05:48.200
<v Jarek Potiuk>or in PMCs so-called or project management committees.

00:05:49.120 --> 00:05:50.960
<v Jarek Potiuk>And Airflow is one of the PMCs.

00:05:51.300 --> 00:05:53.720
<v Jarek Potiuk>So one of the project management committees

00:05:53.740 --> 00:05:55.420
<v Jarek Potiuk>which has PMC members.

00:05:56.260 --> 00:05:59.940
<v Jarek Potiuk>We are both PMC members and we have like 50 other individuals

00:06:00.400 --> 00:06:02.240
<v Jarek Potiuk>or 60, I can't remember, like the number changes,

00:06:02.420 --> 00:06:04.160
<v Jarek Potiuk>like we are inviting new ones all the time.

00:06:05.460 --> 00:06:08.540
<v Jarek Potiuk>And we make decisions as humans, as individuals,

00:06:08.960 --> 00:06:11.820
<v Jarek Potiuk>not the corporates who are employing us, for example,

00:06:12.000 --> 00:06:15.320
<v Jarek Potiuk>because it's a meritocracy based system

00:06:16.060 --> 00:06:20.160
<v Jarek Potiuk>where people have merit and the merit doesn't expire

00:06:20.280 --> 00:06:23.040
<v Jarek Potiuk>and the merit doesn't belong to individuals,

00:06:23.320 --> 00:06:25.580
<v Jarek Potiuk>not to the corporates.

00:06:26.960 --> 00:06:29.880
<v Jarek Potiuk>And yeah, so that's one of the big,

00:06:31.700 --> 00:06:34.380
<v Jarek Potiuk>like pretty much all the open source software out there

00:06:34.520 --> 00:06:38.420
<v Jarek Potiuk>like has some Apache foundation or Apache component in it.

00:06:38.420 --> 00:06:42.220
<v Jarek Potiuk>It started with Apache server 28, 30 years ago almost,

00:06:42.860 --> 00:06:46.060
<v Jarek Potiuk>but now we have more than 300, 200 PMCs.

00:06:47.020 --> 00:06:51.940
<v Jarek Potiuk>We just passed 10,000 committers mark two months ago, I think.

00:06:52.620 --> 00:06:56.420
<v Jarek Potiuk>So like lots of individuals, lots of people contributing to the foundation.

00:06:56.660 --> 00:06:59.760
<v Jarek Potiuk>And the main thing about foundation is community over code.

00:06:59.800 --> 00:07:02.980
<v Jarek Potiuk>So we value building communities more than actually producing code.

00:07:03.060 --> 00:07:07.800
<v Jarek Potiuk>We believe producing code is just byproduct of great communities working together.

00:07:10.100 --> 00:07:15.200
<v Jarek Potiuk>And ASF is a charity, is a public good charity in US registered in Delaware.

00:07:15.920 --> 00:07:17.340
<v Jarek Potiuk>So we actually cannot be sold.

00:07:17.400 --> 00:07:18.540
<v Jarek Potiuk>We cannot change our license.

00:07:18.840 --> 00:07:21.340
<v Jarek Potiuk>Nothing like that can happen because of the status of the foundation.

00:07:22.040 --> 00:07:25.880
<v Michael Kennedy>How interesting. And a really positive force for open source, right?

00:07:26.440 --> 00:07:37.560
<v Jarek Potiuk>Oh, absolutely. Absolutely. And it's when I met when I first got into like learning how ISF works, I said like, that it has no chance to work like there is no way it works.

00:07:38.240 --> 00:07:39.680
<v Michael Kennedy>It's too idealistic. There's no way.

00:07:39.680 --> 00:07:44.260
<v Jarek Potiuk>It's too. Yeah, absolutely. And nobody in the foundation who makes decision gets any money.

00:07:44.500 --> 00:07:47.120
<v Jarek Potiuk>Like everyone is a volunteer, all the PMC members,

00:07:47.220 --> 00:07:50.160
<v Jarek Potiuk>all the commuters, all the board members,

00:07:50.400 --> 00:07:52.800
<v Jarek Potiuk>all president, all the VVPs,

00:07:53.120 --> 00:07:55.100
<v Jarek Potiuk>those are all volunteer driven roles.

00:07:55.440 --> 00:07:56.880
<v Jarek Potiuk>And those are the people who make decisions.

00:07:57.400 --> 00:08:00.000
<v Jarek Potiuk>We just pay a few people in infrastructure and security.

00:08:00.280 --> 00:08:00.840
<v Jarek Potiuk>That's basically it.

00:08:01.140 --> 00:08:01.380
<v Michael Kennedy>- Right.

00:08:02.500 --> 00:08:02.980
<v Michael Kennedy>Awesome.

00:08:03.340 --> 00:08:03.880
<v Michael Kennedy>Well, very cool.

00:08:04.520 --> 00:08:06.400
<v Michael Kennedy>So let's dive into it.

00:08:06.420 --> 00:08:09.680
<v Michael Kennedy>What is, let's start by just talking about

00:08:10.300 --> 00:08:11.620
<v Michael Kennedy>high level abstract.

00:08:12.780 --> 00:08:13.860
<v Michael Kennedy>What is a monorepo?

00:08:14.700 --> 00:08:19.120
<v Michael Kennedy>I think it's so easy to make that sound

00:08:19.320 --> 00:08:20.900
<v Michael Kennedy>like the same thing as a monolith.

00:08:21.020 --> 00:08:23.140
<v Michael Kennedy>You're like, oh yeah, monorepo, monolith, same thing, right?

00:08:23.760 --> 00:08:25.280
<v Michael Kennedy>And yet you're shaking your head.

00:08:25.680 --> 00:08:26.800
<v Jarek Potiuk>- No, not even close.

00:08:27.380 --> 00:08:29.900
<v Jarek Potiuk>Yeah, the first time I met personally monorepo,

00:08:30.040 --> 00:08:31.460
<v Jarek Potiuk>maybe I can continue with that,

00:08:31.480 --> 00:08:32.719
<v Jarek Potiuk>but that was like at Google,

00:08:33.300 --> 00:08:34.880
<v Jarek Potiuk>where I worked at Google years ago,

00:08:35.099 --> 00:08:37.960
<v Jarek Potiuk>and I was surprised coming to Google

00:08:38.140 --> 00:08:41.159
<v Jarek Potiuk>that all the code there is in a single monorepo,

00:08:41.719 --> 00:08:43.580
<v Jarek Potiuk>even though we have hundreds of products

00:08:43.760 --> 00:08:45.520
<v Jarek Potiuk>and all the stuff you see.

00:08:45.840 --> 00:08:47.420
<v Michael Kennedy>- It's gotta be a lot of code, right?

00:08:47.500 --> 00:08:49.740
<v Michael Kennedy>Like a giant, giant repo.

00:08:50.170 --> 00:08:52.460
<v Jarek Potiuk>- It's like now they have like maybe four.

00:08:52.840 --> 00:08:54.620
<v Jarek Potiuk>I don't know, I've heard some stories.

00:08:55.790 --> 00:08:57.220
<v Jarek Potiuk>I don't work there for a long time now.

00:08:57.780 --> 00:08:59.980
<v Jarek Potiuk>But for me, that was a sign that

00:09:00.780 --> 00:09:03.120
<v Jarek Potiuk>you don't really have to split and dice and slice

00:09:03.340 --> 00:09:06.620
<v Jarek Potiuk>your repositories into many, many small ones,

00:09:06.790 --> 00:09:09.580
<v Jarek Potiuk>even if you have like non-monolithical product,

00:09:10.080 --> 00:09:14.420
<v Jarek Potiuk>that it all can be kept in a single repository,

00:09:15.280 --> 00:09:17.060
<v Jarek Potiuk>separate source trees maybe, separate like,

00:09:18.040 --> 00:09:19.740
<v Jarek Potiuk>we'll talk about how we do it in Airflow,

00:09:20.190 --> 00:09:24.120
<v Jarek Potiuk>but it's a way how you can bind it together

00:09:24.480 --> 00:09:28.000
<v Jarek Potiuk>and have it tested together and have it developed together,

00:09:28.640 --> 00:09:30.880
<v Jarek Potiuk>even though each piece is pretty much separate

00:09:31.140 --> 00:09:32.700
<v Jarek Potiuk>and you can work on them separately.

00:09:33.080 --> 00:09:35.160
<v Jarek Potiuk>So that's the monorepo, as opposed to multirepo,

00:09:35.280 --> 00:09:38.679
<v Jarek Potiuk>which is like when you have multiple repositories

00:09:38.700 --> 00:09:41.360
<v Jarek Potiuk>consisting of whatever is comes up as a product.

00:09:43.720 --> 00:09:48.360
<v Amogh Desai>Yep. I agree with everything that Jarek said, plus just a small addition,

00:09:48.560 --> 00:09:54.440
<v Amogh Desai>which is each of the component or the tiny bit of a monorepo

00:09:55.000 --> 00:09:58.000
<v Amogh Desai>can have its own build artifacts, its dependencies.

00:09:58.900 --> 00:10:03.480
<v Amogh Desai>And also it can also have its own release cycle or a release vehicle.

00:10:05.320 --> 00:10:06.820
<v Amogh Desai>That's the only addition,

00:10:06.980 --> 00:10:11.220
<v Amogh Desai>but everything is put together as a big puzzle just to keep the right it could have it if it's

00:10:11.400 --> 00:10:16.380
<v Michael Kennedy>in python terms you know not every mono repo is python but in python terms it could have its own

00:10:16.560 --> 00:10:22.540
<v Jarek Potiuk>pyproject.toml potentially its own virtual environment yes right yes exactly yeah yeah

00:10:22.720 --> 00:10:31.919
<v Michael Kennedy>i think one of the nomenclature ironies of this is often the mono repo i think makes more sense

00:10:31.940 --> 00:10:37.140
<v Michael Kennedy>when you are working with lots of small parts right where the monolith maybe it has a couple

00:10:37.140 --> 00:10:41.800
<v Michael Kennedy>of things but it doesn't depend real deeply the more interconnections you have and the harder

00:10:41.900 --> 00:10:48.120
<v Michael Kennedy>it is to manage those versions the more something like this makes sense right absolutely so so the

00:10:48.140 --> 00:10:54.200
<v Jarek Potiuk>main thing is like people really make a connection between isolated work on part of the system

00:10:54.960 --> 00:11:00.260
<v Jarek Potiuk>into having to have separate repository for that which is completely not the case like you can

00:11:00.260 --> 00:11:05.080
<v Jarek Potiuk>actually have an isolated sub part of the repository even if it's git git doesn't have

00:11:05.080 --> 00:11:09.700
<v Jarek Potiuk>like gift have some modules and sub repos and all the stuff but even like in a single git

00:11:09.820 --> 00:11:15.500
<v Jarek Potiuk>repository you can easily have like start working and focusing on a small part of of the whole

00:11:15.760 --> 00:11:21.040
<v Jarek Potiuk>monorepo and only care about that and that's what the monorepo is

00:11:23.680 --> 00:11:27.920
<v Michael Kennedy>yeah you know i'm not a i'm gonna go ahead and put it out there i'm not a big fan of

00:11:27.940 --> 00:11:37.260
<v Michael Kennedy>of microservice architectures, I kind of find it's trading code complexity for DevOps and

00:11:37.380 --> 00:11:41.160
<v Michael Kennedy>deployment complexity. And I think we have better tools to manage code complexity than DevOps

00:11:41.540 --> 00:11:49.860
<v Michael Kennedy>complexity. But something like this does help you manage those kinds of deployments as well,

00:11:50.340 --> 00:11:50.800
<v Michael Kennedy>better, right?

00:11:51.440 --> 00:11:57.900
<v Jarek Potiuk>Yes, yes. I use the term mini services, not microservices. Microservices is just

00:11:57.920 --> 00:12:02.360
<v Jarek Potiuk>much. But then you can have a lot of a number of mini services, but not micro.

00:12:02.780 --> 00:12:05.480
<v Jarek Potiuk>It's like micro was just too much of a mixed feed.

00:12:05.520 --> 00:12:07.440
<v Michael Kennedy>Yeah, I can get on board with that. Amak, what do you think?

00:12:08.320 --> 00:12:12.040
<v Amogh Desai>Yeah, I like that idea as well. Mini services. Maybe you should coin that.

00:12:12.880 --> 00:12:16.540
<v Michael Kennedy>Yeah, it's like it's the microservices are too small. It feels to me like the

00:12:16.840 --> 00:12:22.620
<v Michael Kennedy>equivalent of when you're trying to write unit tests and you're like, oh, what if I

00:12:23.020 --> 00:12:26.580
<v Michael Kennedy>get a customer and I set their first name and then I check that their first name is

00:12:26.600 --> 00:12:29.600
<v Michael Kennedy>set, like, what are you doing? You don't need to check that assignment works. This is too,

00:12:29.960 --> 00:12:31.840
<v Michael Kennedy>you're just too much in the weeds. You know what I mean?

00:12:31.840 --> 00:12:34.320
<v Jarek Potiuk>This is what AI agents do now all the time.

00:12:38.280 --> 00:12:41.240
<v Michael Kennedy>Yeah, think of the code coverage. Just think of the code coverage. Come on.

00:12:43.880 --> 00:12:47.700
<v Michael Kennedy>You've got some goals to hit. You said 80% code coverage. It's on top of it.

00:12:49.100 --> 00:12:53.880
<v Michael Kennedy>All right. So that's, that sets the stage. Let's talk a little bit about

00:12:54.700 --> 00:12:56.940
<v Michael Kennedy>specifically how Apache Airflow

00:12:58.600 --> 00:13:01.120
<v Michael Kennedy>has come to need this basically.

00:13:03.300 --> 00:13:07.160
<v Michael Kennedy>You shared with me the GitHub pulse for Apache Airflow.

00:13:08.240 --> 00:13:13.020
<v Michael Kennedy>And I think it's kind of worth looking at just how much

00:13:14.560 --> 00:13:17.120
<v Michael Kennedy>open source interest and traffic there is.

00:13:17.330 --> 00:13:20.800
<v Michael Kennedy>Who wants to kind of summarize this weekly pulse here?

00:13:21.020 --> 00:13:21.380
<v Michael Kennedy>I'm okay.

00:13:23.280 --> 00:13:24.100
<v Michael Kennedy>No, Mark, do it.

00:13:25.260 --> 00:13:33.700
<v Amogh Desai>So, yep. This is not the best week in terms of the number of commits. We have had even more read,

00:13:33.920 --> 00:13:43.160
<v Amogh Desai>but this is just one of those weeks. Yeah, one of the usual weeks. So between Feb 3 and Feb 10,

00:13:43.220 --> 00:13:53.440
<v Amogh Desai>we've had about 310 active pull requests so you can imagine that's uh about 40 plus pull requests

00:13:53.600 --> 00:14:00.620
<v Amogh Desai>a day a lot of a lot of them are being assisted by the uh you know the ai revolution going on but

00:14:00.720 --> 00:14:07.120
<v Amogh Desai>yeah again that's a lot of pull requests and we have merged about 200 of them and

00:14:08.400 --> 00:14:14.280
<v Amogh Desai>about 100 are open and similarly with issues right uh 35 new issues uh five issues per day

00:14:14.920 --> 00:14:21.580
<v Amogh Desai>so that's a lot of traffic so you can imagine the amount of review pressure each of

00:14:21.800 --> 00:14:29.080
<v Amogh Desai>uh each of the maintenance has here there's 300 pull requests spread across i don't know one

00:14:29.660 --> 00:14:37.519
<v Amogh Desai>120 130 maybe 140 distributions and each of each of the distributions having like a swim lane owner

00:14:38.660 --> 00:14:42.060
<v Amogh Desai>who is actively trying to take a look at these pull requests.

00:14:42.220 --> 00:14:45.780
<v Amogh Desai>So it's just another week, to be very honest.

00:14:46.860 --> 00:14:50.040
<v Jarek Potiuk>And it's more than 25 PRs a day, including weekends.

00:14:51.860 --> 00:14:52.340
<v Michael Kennedy>Incredible.

00:14:52.620 --> 00:14:57.580
<v Michael Kennedy>And how many of these PRs are high value?

00:14:58.380 --> 00:14:59.800
<v Michael Kennedy>I guess I'm trying to get the sense of,

00:14:59.920 --> 00:15:01.140
<v Michael Kennedy>how much does this get accepted?

00:15:01.280 --> 00:15:03.420
<v Michael Kennedy>Are these just people throwing stuff out there

00:15:03.440 --> 00:15:05.320
<v Michael Kennedy>that doesn't make sense for the direction of airflow?

00:15:05.440 --> 00:15:13.060
<v Jarek Potiuk>So well, those merged all make sense because they are reviewed and merged by Airflow maintainers.

00:15:13.240 --> 00:15:14.520
<v Jarek Potiuk>And we are very serious about that.

00:15:14.670 --> 00:15:18.300
<v Jarek Potiuk>So like we don't merge anything that doesn't pass our bar, which is like very high,

00:15:18.780 --> 00:15:19.580
<v Jarek Potiuk>like extremely high.

00:15:19.670 --> 00:15:28.720
<v Jarek Potiuk>Like we have 170 prac hooks which are checking if the code is doing what it was supposed to be doing

00:15:28.830 --> 00:15:30.320
<v Jarek Potiuk>and if it's architected properly.

00:15:30.600 --> 00:15:38.200
<v Jarek Potiuk>on top of that we have uh individuals people like among myself and then maybe 50 other uh pmc

00:15:38.320 --> 00:15:43.880
<v Jarek Potiuk>members and committees uh who are reviewing it and making their comments and know the system uh

00:15:44.280 --> 00:15:50.040
<v Jarek Potiuk>enough to direct people so they may make sense we do have recently and that was a recurring them at

00:15:50.040 --> 00:15:55.860
<v Jarek Potiuk>the fosden uh conference last week when i was there about like the ai uh generated contributions

00:15:55.920 --> 00:16:01.760
<v Jarek Potiuk>and many of the ai generated contributions are not the best quality it's not like ai is bad

00:16:01.960 --> 00:16:07.440
<v Jarek Potiuk>quality is that like many of those are easier to produce and they might have bad quality so we are

00:16:07.540 --> 00:16:14.460
<v Jarek Potiuk>now learning how to filter them out and how to make the to handle them quickly but but those are the

00:16:14.470 --> 00:16:23.940
<v Amogh Desai>the actual high value prs that we merged nice in in terms of numbers if you if i may the it would be

00:16:23.960 --> 00:16:28.640
<v Amogh Desai>maybe a third of the open pull requests that are nice, general trend.

00:16:29.200 --> 00:16:30.320
<v Michael Kennedy>Yeah, that's pretty good, honestly.

00:16:31.770 --> 00:16:32.380
<v Michael Kennedy>Yep. That's pretty good.

00:16:32.390 --> 00:16:36.920
<v Amogh Desai>We have some guidelines published very recently and due to that we have seen a dip in

00:16:37.960 --> 00:16:45.840
<v Amogh Desai>such quality of PRs. We published some guidelines in our contribution guides about what will be the

00:16:45.860 --> 00:16:54.220
<v Amogh Desai>action taken if uh you know bad quality prs are raised or uh non or ps erased where the author

00:16:54.340 --> 00:17:01.340
<v Amogh Desai>does not know the context but the ai does yeah sure yeah yeah i don't want to go down this rat

00:17:01.340 --> 00:17:07.260
<v Michael Kennedy>hole people hear this enough lately but i just it's been in the news lately that um open source

00:17:07.500 --> 00:17:14.800
<v Michael Kennedy>projects have been kind of getting a barrage of ai submissions and i think that comes in a couple of

00:17:14.819 --> 00:17:22.079
<v Michael Kennedy>flavors one people who just want to get their name listed as a contributor maybe it helps them with

00:17:22.079 --> 00:17:27.120
<v Michael Kennedy>their job or whatever so there's like a small incentive there but it's been really bad for bug

00:17:27.180 --> 00:17:32.480
<v Michael Kennedy>bounties like curl closed its bug bounty program because people were trying to make the 50 or 250

00:17:32.780 --> 00:17:38.740
<v Michael Kennedy>dollars by finding some issue with ai is that a problem for you all just taking the pulse of a big

00:17:38.740 --> 00:17:44.120
<v Jarek Potiuk>project like that it it it is i actually had a talk about that at the global vulnerability

00:17:44.560 --> 00:17:49.920
<v Jarek Potiuk>intelligence platform summit just before fosden so that was exactly like i i even quoted daniel

00:17:50.060 --> 00:17:56.640
<v Jarek Potiuk>stanberg and i met him there at fosden like they were really cool uh that uh but there are some

00:17:56.860 --> 00:18:02.280
<v Jarek Potiuk>different motivations of people who are submitting those those ai issues and we should fight with the

00:18:02.960 --> 00:18:07.920
<v Jarek Potiuk>in different ways with different uh approaches or like you know respond to those motivations

00:18:07.940 --> 00:18:13.760
<v Jarek Potiuk>somehow we have some ideas we have an open discussion uh in github maintainers uh list

00:18:13.980 --> 00:18:19.340
<v Jarek Potiuk>right now and github is trying to up to uh to address it by like just discussing what they can

00:18:19.370 --> 00:18:24.200
<v Jarek Potiuk>do right now and that's the highest priority for them also we have a discussion with ossf

00:18:24.810 --> 00:18:31.760
<v Jarek Potiuk>for security uh kind of guidelines or policies for open source maintainers how to deal with those

00:18:31.800 --> 00:18:38.160
<v Jarek Potiuk>issues and i'm sure we will work out some ways and toolings and most of all uh processes

00:18:38.380 --> 00:18:42.840
<v Jarek Potiuk>and like being assertive is one thing like just saying no when the report doesn't meet all the bars

00:18:43.740 --> 00:18:48.480
<v Jarek Potiuk>immediately and you know directing people to the description is good enough of a of a you know

00:18:48.740 --> 00:18:55.760
<v Jarek Potiuk>barrier for uh you know getting kind of completely broken prs because we have to just make it more

00:18:55.760 --> 00:19:01.860
<v Jarek Potiuk>expensive for the reporters than for the maintainers to diagnose the issues or yeah decide if the

00:19:01.920 --> 00:19:06.840
<v Michael Kennedy>issues are bad or good yeah and i'm not necessarily saying that there's something inherently bad

00:19:07.100 --> 00:19:11.940
<v Michael Kennedy>because ai wrote some of the code than a person ai can write really good code better than a lot of

00:19:12.040 --> 00:19:19.080
<v Michael Kennedy>people i've seen but it it has this sort of shotgun effect often of just like i'm going to change all

00:19:19.180 --> 00:19:24.780
<v Michael Kennedy>these files and it's not as focused and clear a lot of times it just it doesn't it doesn't get the

00:19:24.660 --> 00:19:25.560
<v Michael Kennedy>the Zen of it, you know?

00:19:26.100 --> 00:19:26.800
<v Michael Kennedy>Amogh, what do you think?

00:19:27.420 --> 00:19:28.420
<v Amogh Desai>- Yeah, I agree with that.

00:19:29.540 --> 00:19:32.080
<v Amogh Desai>It'll generate code, which it thinks is good,

00:19:32.240 --> 00:19:34.380
<v Amogh Desai>but we don't really know the ripple effects.

00:19:35.060 --> 00:19:37.700
<v Amogh Desai>And we want to avoid such things.

00:19:38.260 --> 00:19:43.760
<v Michael Kennedy>- Yeah, yeah, you've such a long living app

00:19:43.820 --> 00:19:45.440
<v Michael Kennedy>with lots of complexity, right?

00:19:46.020 --> 00:19:48.440
<v Jarek Potiuk>- We all are using AI for generating the code,

00:19:48.900 --> 00:19:49.220
<v Jarek Potiuk>to be honest.

00:19:49.560 --> 00:19:51.020
<v Jarek Potiuk>So like, most of my--

00:19:51.020 --> 00:19:52.520
<v Michael Kennedy>- And you should, you should, yeah.

00:19:53.100 --> 00:19:53.300
<v Jarek Potiuk>- Yeah.

00:19:55.100 --> 00:19:55.560
<v Michael Kennedy>it's incredible.

00:19:56.880 --> 00:20:00.200
<v Michael Kennedy>I pulled up this graphic here, and I'll link to it in the show notes.

00:20:00.980 --> 00:20:05.160
<v Michael Kennedy>Just giving people a sense, I got this little utility that I released this week

00:20:05.230 --> 00:20:09.420
<v Michael Kennedy>called Tallyman, which analyzes code and gives you more of a breakdown

00:20:09.610 --> 00:20:11.640
<v Michael Kennedy>than just this many lines or whatever.

00:20:12.630 --> 00:20:16.460
<v Michael Kennedy>So I want to just highlight, maybe you all can riff on this a little bit

00:20:16.460 --> 00:20:17.160
<v Michael Kennedy>to give a sense.

00:20:17.320 --> 00:20:23.860
<v Michael Kennedy>So 1.2 million lines of Python, 918,000 excluding comments.

00:20:24.320 --> 00:20:30.140
<v Michael Kennedy>Maybe a little overcounting the way this thing works, but still 200,000 restructured texts.

00:20:31.250 --> 00:20:38.420
<v Michael Kennedy>The one that really stood out to me, 81,000 lines of YAML and 16,000 lines of TAML, you guys.

00:20:41.280 --> 00:20:41.940
<v Michael Kennedy>That's impressive.

00:20:42.230 --> 00:20:43.180
<v Michael Kennedy>And you know what?

00:20:43.680 --> 00:20:49.940
<v Michael Kennedy>Hat tip to just a sprinkle, just a hint of Java at 42 lines of Java.

00:20:51.020 --> 00:20:54.520
<v Michael Kennedy>But you know, a hundred, almost a million,

00:20:54.980 --> 00:20:57.080
<v Michael Kennedy>just over a million lines of code without comments.

00:20:57.960 --> 00:20:59.440
<v Michael Kennedy>That's a big project.

00:21:00.400 --> 00:21:01.340
<v Michael Kennedy>What do you think?

00:21:03.640 --> 00:21:05.440
<v Jarek Potiuk>- Amok, what happened when you joined?

00:21:07.400 --> 00:21:08.220
<v Amogh Desai>- I don't know.

00:21:08.500 --> 00:21:10.920
<v Amogh Desai>I think it was much lesser, but yeah.

00:21:11.420 --> 00:21:12.880
<v Amogh Desai>- Yes, you did contribute a lot.

00:21:13.600 --> 00:21:14.680
<v Amogh Desai>- It's a lot of code.

00:21:15.200 --> 00:21:18.720
<v Amogh Desai>And you can imagine so because of the number of packages

00:21:18.980 --> 00:21:20.980
<v Amogh Desai>we have in the monorepo discussion

00:21:21.000 --> 00:21:26.440
<v Amogh Desai>We have a lot of packages and the YAML might surprise you at first, but

00:21:26.940 --> 00:21:32.000
<v Amogh Desai>if you actually go and see why the YAML, it's mostly for our providers.

00:21:32.790 --> 00:21:35.380
<v Amogh Desai>So integrations with other systems is something we call as providers.

00:21:36.240 --> 00:21:38.680
<v Amogh Desai>And the spec of the providers is written in YAML.

00:21:39.500 --> 00:21:42.400
<v Amogh Desai>And Toml, I'm sure we'll come to it very, very soon.

00:21:42.420 --> 00:21:50.960
<v Michael Kennedy>Yeah, yes, that's kind of why I pulled this up actually, is the Toml aspect is

00:21:50.980 --> 00:21:52.460
<v Michael Kennedy>of us with that number as we move on.

00:21:53.280 --> 00:21:54.340
<v Michael Kennedy>16,000 lines of TAML.

00:21:54.440 --> 00:21:57.720
<v Michael Kennedy>That's a lot of pyproject.taml going on right there, folks.

00:21:58.340 --> 00:21:59.000
<v Jarek Potiuk>Oh, yes.

00:21:59.040 --> 00:21:59.640
<v Jarek Potiuk>Oh, yes.

00:22:00.320 --> 00:22:01.740
<v Jarek Potiuk>And lots of it is generated, actually.

00:22:01.900 --> 00:22:05.580
<v Jarek Potiuk>So because we actually generate quite a lot of the YAML

00:22:05.600 --> 00:22:07.760
<v Jarek Potiuk>and TAML that we have, and we keep it in the repo,

00:22:08.120 --> 00:22:10.280
<v Jarek Potiuk>because we don't want to regenerate every time.

00:22:10.560 --> 00:22:14.960
<v Jarek Potiuk>So it's a lot-- we don't write YAML by hand, no.

00:22:16.019 --> 00:22:17.100
<v Michael Kennedy>Yeah, of course.

00:22:18.140 --> 00:22:18.480
<v Michael Kennedy>Very cool.

00:22:18.660 --> 00:22:21.300
<v Michael Kennedy>- Okay, so now, you know, let's,

00:22:22.320 --> 00:22:24.460
<v Michael Kennedy>maybe we can start by introducing this

00:22:24.460 --> 00:22:27.940
<v Michael Kennedy>by just giving a shout out to this series

00:22:28.100 --> 00:22:31.940
<v Michael Kennedy>that you wrote over here on Medium, Erik.

00:22:32.960 --> 00:22:33.140
<v Michael Kennedy>- Yeah.

00:22:33.340 --> 00:22:35.760
<v Michael Kennedy>- Modern Python repo for Apache Airflow,

00:22:36.140 --> 00:22:37.300
<v Michael Kennedy>parts one through four.

00:22:38.100 --> 00:22:38.460
<v Michael Kennedy>- Yes.

00:22:39.620 --> 00:22:42.920
<v Jarek Potiuk>Yes, I initially started discussing this blog post idea

00:22:43.260 --> 00:22:44.020
<v Jarek Potiuk>with a few people.

00:22:45.280 --> 00:22:51.000
<v Jarek Potiuk>And people are busy and I couldn't get people to write it.

00:22:51.220 --> 00:22:52.560
<v Jarek Potiuk>So I decided to write it myself.

00:22:52.900 --> 00:22:55.800
<v Jarek Potiuk>Well, with a lot of AI help, of course.

00:22:56.060 --> 00:22:58.500
<v Jarek Potiuk>It's not that everything is written by hand.

00:22:59.900 --> 00:23:03.180
<v Jarek Potiuk>And when I wrote it, I realized it's too big.

00:23:03.580 --> 00:23:05.320
<v Jarek Potiuk>And I had to split it into four.

00:23:06.500 --> 00:23:08.460
<v Jarek Potiuk>But the idea was to document what we've done.

00:23:09.180 --> 00:23:10.260
<v Jarek Potiuk>Because I think that a lot of people

00:23:10.260 --> 00:23:13.500
<v Jarek Potiuk>are struggling with monorepo versus multirepo

00:23:13.520 --> 00:23:15.720
<v Jarek Potiuk>or like how they should do their repository

00:23:16.140 --> 00:23:18.380
<v Jarek Potiuk>in when they are a project growth.

00:23:19.500 --> 00:23:22.600
<v Jarek Potiuk>And there were lots of discussions in the past,

00:23:22.760 --> 00:23:26.260
<v Jarek Potiuk>including one of the podcasts of yours

00:23:26.460 --> 00:23:28.100
<v Jarek Potiuk>were Monorepo versus MultiRepo.

00:23:28.100 --> 00:23:29.580
<v Jarek Potiuk>And I can't remember who that was,

00:23:29.580 --> 00:23:31.940
<v Jarek Potiuk>but there was discussion about like going back and forth

00:23:32.160 --> 00:23:34.420
<v Jarek Potiuk>and like finding that people sometimes go back

00:23:34.600 --> 00:23:37.640
<v Jarek Potiuk>and then go forth and like in different directions

00:23:37.900 --> 00:23:41.520
<v Jarek Potiuk>because there are different problems with both approaches.

00:23:42.180 --> 00:23:44.780
<v Jarek Potiuk>So I just wanted to document the reasoning why we are doing it,

00:23:45.880 --> 00:23:49.680
<v Jarek Potiuk>like why it's possible now because of the packaging ecosystem

00:23:50.700 --> 00:23:56.140
<v Jarek Potiuk>maturing for Python and uv and other tools coming into the space.

00:23:57.080 --> 00:24:01.160
<v Jarek Potiuk>And then the last part was like really the kind of a little bit innovative

00:24:01.330 --> 00:24:05.000
<v Jarek Potiuk>approach that we do where the tooling is still not catching up with what we need

00:24:05.100 --> 00:24:06.900
<v Jarek Potiuk>and what we did.

00:24:07.120 --> 00:24:11.460
<v Jarek Potiuk>So yeah, so those are the kind of history

00:24:11.840 --> 00:24:14.840
<v Jarek Potiuk>why we are doing it, the packaging,

00:24:16.779 --> 00:24:19.300
<v Jarek Potiuk>the automated verification with Prack,

00:24:19.470 --> 00:24:20.360
<v Jarek Potiuk>that was the third part.

00:24:20.370 --> 00:24:23.000
<v Jarek Potiuk>And the fourth part was about like this shared

00:24:24.600 --> 00:24:28.040
<v Jarek Potiuk>libraries, innovative concept that we added for Earthful.

00:24:28.520 --> 00:24:28.960
<v Michael Kennedy>- Nice.

00:24:29.090 --> 00:24:31.980
<v Michael Kennedy>Yeah, I'll link to the series as well as to a talk

00:24:31.980 --> 00:24:34.580
<v Michael Kennedy>that you gave at Vostum that just got published, right?

00:24:35.600 --> 00:24:36.740
<v Jarek Potiuk>Yes, a few days ago, yes.

00:24:37.240 --> 00:24:38.320
<v Jarek Potiuk>Yeah, that's a good talk.

00:24:38.400 --> 00:24:41.880
<v Jarek Potiuk>They have an amazing system of recording and publishing stuff.

00:24:42.180 --> 00:24:45.460
<v Jarek Potiuk>Like for the volunteer-driven conference, 1,000 speakers.

00:24:46.080 --> 00:24:47.240
<v Jarek Potiuk>Oh, that's amazing.

00:24:47.440 --> 00:24:48.480
<v Jarek Potiuk>That works like brilliant.

00:24:50.160 --> 00:24:51.740
<v Michael Kennedy>Probably some automation going on there.

00:24:52.340 --> 00:24:53.480
<v Michael Kennedy>Oh, a lot.

00:24:55.980 --> 00:25:00.760
<v Michael Kennedy>Yeah, so let's talk a little bit about, I guess, the problems that you ran into

00:25:02.600 --> 00:25:06.820
<v Michael Kennedy>because initially there were some challenges with the standards and tooling

00:25:06.940 --> 00:25:11.080
<v Michael Kennedy>not be there and you actually one of the takeaways if people read the series or

00:25:11.120 --> 00:25:16.600
<v Michael Kennedy>watch the talk is you actually had to work with some of the tool providers to

00:25:16.760 --> 00:25:21.020
<v Michael Kennedy>make this possible so not only is it like well the tools have changed what we

00:25:21.180 --> 00:25:26.020
<v Michael Kennedy>could do this it's you all have changed the tools a little bit through you know

00:25:25.860 --> 00:25:33.860
<v Michael Kennedy>working closely like hey we've got this 1 million line project with 100 sub modules or more help

00:25:34.500 --> 00:25:39.600
<v Michael Kennedy>like it's your tools to support this help me make this work right what were some of the problems

00:25:41.740 --> 00:25:46.140
<v Jarek Potiuk>okay so let me start with this cooperation and maybe you know amok can also explain like what

00:25:46.180 --> 00:25:51.480
<v Jarek Potiuk>was before and after because like he experienced that firsthand as a as a user kind of this kind of

00:25:51.300 --> 00:25:57.620
<v Jarek Potiuk>repository structure but for me the idea was like i i was working on it for years like uh when

00:25:57.740 --> 00:26:03.920
<v Jarek Potiuk>we went to airflow two five years ago uh we or four years ago i can't remember that's a long time

00:26:04.420 --> 00:26:09.000
<v Jarek Potiuk>we didn't have all the tooling and we had to do pretty much everything that we do now with the

00:26:09.140 --> 00:26:16.880
<v Jarek Potiuk>with monorepo and uv uh by hand uh by bash scripts by that time by crazy so like if you run it three

00:26:16.900 --> 00:26:24.520
<v Jarek Potiuk>years ago your code you would see more than 10 000 lines of bash code which i wrote oh wow we since

00:26:24.620 --> 00:26:30.120
<v Michael Kennedy>that is not joyful that doesn't spark joy no no no that's why we removed it with some outreach

00:26:30.360 --> 00:26:36.200
<v Jarek Potiuk>internship actually and shout out to edit and borna who were our outreach mentors who helped us to

00:26:36.879 --> 00:26:44.480
<v Jarek Potiuk>convert it to python which was really helpful uh so that that's how it started no tooling uh a need

00:26:44.540 --> 00:26:50.500
<v Jarek Potiuk>need because we grew we wanted to have more providers more integrations and it already was

00:26:50.980 --> 00:26:55.760
<v Jarek Potiuk>quite difficult to manage if they all were part of single distribution so we have to split into

00:26:56.240 --> 00:27:03.880
<v Jarek Potiuk>many distributions 60 i think at the beginning now we have more than 100 now now uh and uh when we

00:27:03.890 --> 00:27:09.760
<v Jarek Potiuk>did that i we had to do all manually and like working with that was like really cumbersome

00:27:09.820 --> 00:27:14.940
<v Jarek Potiuk>and maybe you know like i can i can switch to to amok so he can say like the past experience a new

00:27:15.060 --> 00:27:21.680
<v Jarek Potiuk>experience because like he experienced the change himself yeah the past experience was

00:27:21.780 --> 00:27:28.960
<v Amogh Desai>scary to be to speak the least uh whenever i uh switch branches or have to rebase for whatever

00:27:29.140 --> 00:27:35.680
<v Amogh Desai>reason it i had a nightmare a very bad time trying to you know package things together and try to

00:27:35.700 --> 00:27:36.300
<v Amogh Desai>to run something.

00:27:36.440 --> 00:27:38.200
<v Amogh Desai>And I think Jarek found me often,

00:27:39.220 --> 00:27:40.680
<v Amogh Desai>ranting on the Slack channels that,

00:27:40.700 --> 00:27:42.380
<v Amogh Desai>hey, this doesn't work, hey, that doesn't work,

00:27:42.580 --> 00:27:42.940
<v Amogh Desai>what do we do?

00:27:44.740 --> 00:27:46.300
<v Amogh Desai>Now it's very easy.

00:27:48.059 --> 00:27:50.320
<v Amogh Desai>It's effortless, almost effortless compared to

00:27:51.060 --> 00:27:53.040
<v Amogh Desai>what we had years, maybe like five years ago,

00:27:53.140 --> 00:27:53.640
<v Amogh Desai>four years ago.

00:27:54.340 --> 00:27:54.960
<v Michael Kennedy>- Yeah, amazing.

00:27:55.580 --> 00:27:56.680
<v Michael Kennedy>How does GitHub deal?

00:27:57.780 --> 00:27:58.840
<v Jarek Potiuk>- Just to add to that,

00:27:59.060 --> 00:27:59.240
<v Michael Kennedy>- Go ahead.

00:27:59.360 --> 00:28:00.320
<v Jarek Potiuk>- Before we go on.

00:28:00.700 --> 00:28:02.900
<v Jarek Potiuk>So like the part of it was also that the,

00:28:05.240 --> 00:28:09.500
<v Jarek Potiuk>been listening so like i was the only one who actually managed the whole thing for years and

00:28:09.550 --> 00:28:14.960
<v Jarek Potiuk>i was like overwhelmed as well when people have problems of course so then the change that we've

00:28:15.020 --> 00:28:20.020
<v Jarek Potiuk>done was not only with the tooling and as you mentioned we were actually cooperating with charlie

00:28:20.500 --> 00:28:27.000
<v Jarek Potiuk>from astral charlie marsh and with joe from feck uh because we had this need we had it implemented

00:28:27.220 --> 00:28:31.700
<v Jarek Potiuk>ourselves and then they could look at how we've done that and they could implement it properly in

00:28:31.720 --> 00:28:37.280
<v Jarek Potiuk>their tooling and we've been like exchanging the you know like charlie was even interviewing me at

00:28:37.360 --> 00:28:43.340
<v Jarek Potiuk>some point of time how we how what what are our needs uh so so i have for a long time i have this

00:28:43.960 --> 00:28:50.960
<v Jarek Potiuk>this motto that uh the best way to foresee future is to shape it and like so we did shape the future

00:28:51.160 --> 00:28:55.760
<v Jarek Potiuk>by you know talking to those tool providers so that they can or builders so that they could build

00:28:55.770 --> 00:29:00.400
<v Jarek Potiuk>it for us and work with us and we help them to test and everything like that but also it was like

00:29:00.360 --> 00:29:07.120
<v Jarek Potiuk>listening to amok and other contributors like all the problems they had or like and then when i

00:29:07.180 --> 00:29:12.240
<v Jarek Potiuk>solved it i would i wouldn't also only solve it with the new tooling but we also engaged all the

00:29:12.540 --> 00:29:17.800
<v Jarek Potiuk>more people from the from the team like amog and few other active contributors and they were

00:29:17.980 --> 00:29:22.800
<v Jarek Potiuk>actually part of the whole process of conversion and they are now part of the team and now we can

00:29:22.840 --> 00:29:27.539
<v Jarek Potiuk>have this podcast while things are being broken in airflow right now and somebody is probably

00:29:27.560 --> 00:29:28.800
<v Jarek Potiuk>we're fixing it as we speak.

00:29:28.980 --> 00:29:30.360
<v Jarek Potiuk>So not me anymore.

00:29:30.540 --> 00:29:33.600
<v Jarek Potiuk>So those old things are really great.

00:29:34.860 --> 00:29:36.060
<v Michael Kennedy>- That's really, really good.

00:29:37.260 --> 00:29:37.740
<v Michael Kennedy>Yeah, incredible.

00:29:38.660 --> 00:29:41.600
<v Michael Kennedy>How does GitHub deal with so many files

00:29:41.860 --> 00:29:42.700
<v Michael Kennedy>and such a big project?

00:29:42.940 --> 00:29:45.760
<v Michael Kennedy>Is it fine or is it a challenge?

00:29:46.160 --> 00:29:49.140
<v Jarek Potiuk>- Except yesterday where half of the time-

00:29:49.140 --> 00:29:50.780
<v Michael Kennedy>- Yeah, yeah, except yesterday.

00:29:50.780 --> 00:29:52.380
<v Michael Kennedy>Yeah, for people who don't know,

00:29:52.460 --> 00:29:55.100
<v Michael Kennedy>yesterday morning, at least morning US time,

00:29:55.100 --> 00:29:55.480
<v Michael Kennedy>GitHub was having a moment.

00:29:55.720 --> 00:29:58.380
<v Michael Kennedy>Like it was, I couldn't clone stuff.

00:29:58.840 --> 00:30:04.180
<v Michael Kennedy>I pulled up the random page on GitHub and got the 503 Unicorn.

00:30:04.480 --> 00:30:05.520
<v Michael Kennedy>It was not good, right?

00:30:05.720 --> 00:30:07.480
<v Michael Kennedy>Besides that, excluding that time.

00:30:08.040 --> 00:30:11.900
<v Jarek Potiuk>So the Unicorn is actually a little bit like looking kind of angry at you.

00:30:12.360 --> 00:30:14.340
<v Jarek Potiuk>That's one of the observations I had from yesterday.

00:30:14.870 --> 00:30:18.260
<v Jarek Potiuk>I saw it so many times that it doesn't look nice.

00:30:18.840 --> 00:30:19.520
<v Michael Kennedy>I agree.

00:30:19.580 --> 00:30:20.940
<v Michael Kennedy>That's not a great error page.

00:30:21.080 --> 00:30:23.420
<v Michael Kennedy>Like some error pages are amazing where it's like,

00:30:23.940 --> 00:30:25.780
<v Michael Kennedy>you know, the coyote fell off of a cliff.

00:30:26.000 --> 00:30:26.140
<v Michael Kennedy>Woo!

00:30:26.760 --> 00:30:28.680
<v Michael Kennedy>That one just looks like it's angry back at you.

00:30:29.380 --> 00:30:30.140
<v Jarek Potiuk>- Exactly, exactly.

00:30:30.460 --> 00:30:32.100
<v Jarek Potiuk>So no, besides that, it's perfect.

00:30:32.360 --> 00:30:33.720
<v Jarek Potiuk>It's like, it works like seamlessly,

00:30:33.960 --> 00:30:36.100
<v Jarek Potiuk>no problems whatsoever with the size, with the numbers.

00:30:36.340 --> 00:30:38.000
<v Jarek Potiuk>Like we are very, very happy in general.

00:30:38.660 --> 00:30:40.300
<v Jarek Potiuk>And of course, like things like that happen.

00:30:40.420 --> 00:30:41.260
<v Jarek Potiuk>There is nothing wrong.

00:30:41.660 --> 00:30:42.900
<v Jarek Potiuk>Like there is something wrong,

00:30:42.980 --> 00:30:45.020
<v Jarek Potiuk>but like it's not like that it happens all the time.

00:30:45.200 --> 00:30:45.440
<v Jarek Potiuk>Not really.

00:30:45.660 --> 00:30:47.740
<v Michael Kennedy>- No, it's actually, it's super rare.

00:30:47.900 --> 00:30:49.100
<v Michael Kennedy>GitHub is an incredible service.

00:30:49.400 --> 00:30:56.800
<v Michael Kennedy>I mean, I know there's been some grief about the GitHub actions, but that's a different conversation, right?

00:30:57.060 --> 00:30:57.200
<v Jarek Potiuk>Yeah.

00:30:59.340 --> 00:31:00.040
<v Michael Kennedy>All right.

00:31:00.300 --> 00:31:09.120
<v Michael Kennedy>Let's talk next about how the package standards have changed and how basically some of those things have made it possible.

00:31:09.500 --> 00:31:12.580
<v Michael Kennedy>So in your talk, you pulled up a bunch of different peps,

00:31:13.080 --> 00:31:14.180
<v Michael Kennedy>nine of them or something like that,

00:31:15.480 --> 00:31:17.400
<v Michael Kennedy>that were about packaging,

00:31:18.780 --> 00:31:21.160
<v Michael Kennedy>recently packaging standards and different things like that,

00:31:21.300 --> 00:31:25.060
<v Michael Kennedy>that have made basically the structure that you're working with

00:31:25.120 --> 00:31:26.440
<v Michael Kennedy>and the tools that do it possible.

00:31:27.500 --> 00:31:29.060
<v Michael Kennedy>Do you want to maybe highlight either of you,

00:31:29.100 --> 00:31:31.300
<v Michael Kennedy>some of these things that stand out as like,

00:31:31.740 --> 00:31:33.460
<v Michael Kennedy>actually this one is really important.

00:31:37.400 --> 00:31:41.760
<v Jarek Potiuk>Well, for me, the one which is maybe not super related to Monorepo,

00:31:41.760 --> 00:31:44.460
<v Jarek Potiuk>but it actually helped us a lot, like the PEP 7.2.3,

00:31:45.180 --> 00:31:49.180
<v Jarek Potiuk>the last one but last inline script metadata,

00:31:50.060 --> 00:31:52.200
<v Jarek Potiuk>which is like one of the biggest successes

00:31:52.500 --> 00:31:57.160
<v Jarek Potiuk>and the biggest kind of usages I see from a PEP implemented.

00:31:57.380 --> 00:31:59.460
<v Jarek Potiuk>It caught up very, very quickly.

00:32:00.080 --> 00:32:04.560
<v Jarek Potiuk>It allows to embed inline script metadata into the Python scripts,

00:32:04.760 --> 00:32:07.460
<v Jarek Potiuk>which is like something that we've been dreaming of for years,

00:32:08.280 --> 00:32:11.200
<v Jarek Potiuk>especially for this kind of tooling, the FCI environment, etc.

00:32:11.520 --> 00:32:12.860
<v Jarek Potiuk>This is really, really helpful.

00:32:12.940 --> 00:32:14.760
<v Jarek Potiuk>So that's the one that I would like to highlight.

00:32:15.520 --> 00:32:18.480
<v Jarek Potiuk>But I read all of them many times, all the tabs,

00:32:18.580 --> 00:32:20.980
<v Jarek Potiuk>and they are difficult things to read and understand.

00:32:23.020 --> 00:32:26.560
<v Jarek Potiuk>But they were like, we actually did all that we could

00:32:26.800 --> 00:32:28.780
<v Jarek Potiuk>to be fully compliant,

00:32:29.580 --> 00:32:31.540
<v Jarek Potiuk>not only with the specification of those tabs,

00:32:31.900 --> 00:32:34.400
<v Jarek Potiuk>but also with the kind of spirit of the specification,

00:32:34.740 --> 00:32:39.020
<v Jarek Potiuk>sometimes things are not very precisely described and there are some interpretations and stuff

00:32:39.700 --> 00:32:45.700
<v Jarek Potiuk>so we just we just made sure and this is our our goal as well like we just make sure that all the

00:32:45.800 --> 00:32:51.640
<v Jarek Potiuk> PEP standards that are being published are actually very very meticulously followed and we just try

00:32:51.640 --> 00:32:56.460
<v Jarek Potiuk>to adapt to any changes that are coming in the environment so we know how difficult it is if

00:32:56.580 --> 00:33:00.879
<v Jarek Potiuk>people are sticking to the old ways and like that's that makes difficult for python maintainers

00:33:05.080 --> 00:33:06.380
<v Michael Kennedy>- Mag, any other thoughts?

00:33:07.480 --> 00:33:13.960
<v Amogh Desai>- Yeah, this one is a particularly very important one for us also because it simplifies our

00:33:13.990 --> 00:33:20.960
<v Amogh Desai>pre-commit configurations where earlier we had to specify the dependencies as requires

00:33:21.210 --> 00:33:25.960
<v Amogh Desai>or whatever the particular version was, but now it's all in the script.

00:33:27.540 --> 00:33:34.000
<v Amogh Desai>the pre-commit remains as clean as it could just with the hook name and you know the rejects for

00:33:34.100 --> 00:33:42.180
<v Amogh Desai>the file filter and minimal configurations for it to work well and dependency group is also the other

00:33:42.380 --> 00:33:48.280
<v Amogh Desai> PEP i don't recall the name but i recall the number i think it's six oh i can't remember all the

00:33:48.400 --> 00:33:56.340
<v Michael Kennedy>numbers but one of that would be 735 folks 735 yeah so that's also particularly nice for us we can

00:33:57.380 --> 00:34:05.400
<v Amogh Desai>define the dependency groups in our by projects and it's it's nice to uh how it's how it's really

00:34:05.410 --> 00:34:12.280
<v Amogh Desai>nice how it works with uv so we are very happy with this particular uh dependency group  PEP as

00:34:12.280 --> 00:34:18.080
<v Amogh Desai>well as the uh inline scripts i think right the inline scripts are cool i you know especially

00:34:18.260 --> 00:34:26.799
<v Michael Kennedy>with uv these days it really makes running some kind of python code so much easier it's it's almost

00:34:26.820 --> 00:34:32.980
<v Michael Kennedy>as if everything is standard library you know i can give somebody a file i can say the way you run

00:34:33.100 --> 00:34:38.320
<v Michael Kennedy>it no no no don't i know it looks like you say python but don't say that you say uv run this

00:34:38.560 --> 00:34:43.540
<v Michael Kennedy>and then and that's it like they didn't have to have python they might need 10 dependencies and

00:34:43.600 --> 00:34:49.340
<v Jarek Potiuk>so on it but it doesn't matter right yeah yeah and being standard it makes it also you know like

00:34:49.419 --> 00:34:54.879
<v Jarek Potiuk>other tools are doing the same or hatch run that's the same that's like yeah and then there are there

00:34:54.899 --> 00:34:57.060
<v Jarek Potiuk>There is even support for inline script metadata

00:34:57.460 --> 00:35:00.160
<v Jarek Potiuk>just released in latest pip 26.

00:35:00.960 --> 00:35:04.280
<v Jarek Potiuk>So it's all good because of the standards

00:35:04.380 --> 00:35:06.140
<v Jarek Potiuk>and not because a single particular tool

00:35:06.200 --> 00:35:07.620
<v Jarek Potiuk>does it in an opinionated way.

00:35:07.740 --> 00:35:09.680
<v Jarek Potiuk>So this is really, really, really cool.

00:35:09.860 --> 00:35:13.780
<v Jarek Potiuk>And there is one big benefit of those kinds of apps,

00:35:14.100 --> 00:35:16.060
<v Jarek Potiuk>and particularly inline script metadata,

00:35:16.660 --> 00:35:18.880
<v Jarek Potiuk>is we have less YAML because of that.

00:35:19.180 --> 00:35:19.480
<v Michael Kennedy>- Yeah.

00:35:21.600 --> 00:35:22.760
<v Michael Kennedy>- You already have a lot of YAML.

00:35:22.860 --> 00:35:23.680
<v Michael Kennedy>- Less is better.

00:35:24.840 --> 00:35:26.740
<v Amogh Desai>We have a lot still, we can't complain about that.

00:35:28.380 --> 00:35:29.480
<v Michael Kennedy>- It's better than it was.

00:35:30.020 --> 00:35:32.020
<v Michael Kennedy>Yeah, and so the dependency groups are like,

00:35:32.740 --> 00:35:37.060
<v Michael Kennedy>you know, for dev or for test or something like that, right?

00:35:37.060 --> 00:35:44.640
<v Michael Kennedy>So you can say like uv sync or uv pip install

00:35:44.820 --> 00:35:47.160
<v Michael Kennedy>and you can say like thing bracket dev

00:35:47.200 --> 00:35:48.060
<v Michael Kennedy>or something like that, right?

00:35:48.540 --> 00:35:51.380
<v Jarek Potiuk>- Or actually the nice thing about uv sync

00:35:51.520 --> 00:35:53.920
<v Jarek Potiuk>is that it syncs the dev dependencies automatically

00:35:53.940 --> 00:35:55.220
<v Jarek Potiuk>without you even specifying that,

00:35:55.790 --> 00:35:57.860
<v Jarek Potiuk>which is like the best thing for development

00:35:58.080 --> 00:35:59.460
<v Jarek Potiuk>because you actually always want to have

00:35:59.580 --> 00:36:02.120
<v Jarek Potiuk>development tools with you.

00:36:02.600 --> 00:36:03.520
<v Michael Kennedy>- That's a good point, yeah.

00:36:04.540 --> 00:36:04.940
<v Michael Kennedy>Totally agree.

00:36:05.170 --> 00:36:06.200
<v Jarek Potiuk>Okay, fantastic.

00:36:06.200 --> 00:36:07.600
<v Jarek Potiuk>- That's really cool, that's really cool.

00:36:10.300 --> 00:36:13.540
<v Michael Kennedy>- So that was the changes to Python itself

00:36:13.690 --> 00:36:15.960
<v Michael Kennedy>through the PEPS, but there's also tools

00:36:16.240 --> 00:36:18.820
<v Michael Kennedy>and you've already mentioned some of them, both of them,

00:36:18.960 --> 00:36:20.460
<v Michael Kennedy>but tools that make this possible,

00:36:21.140 --> 00:36:24.420
<v Michael Kennedy>which I mean, I think uv has to be number one

00:36:24.510 --> 00:36:25.620
<v Michael Kennedy>that goes on this list, right?

00:36:25.720 --> 00:36:29.380
<v Michael Kennedy>Like uv has really done some powerful stuff here, right?

00:36:29.950 --> 00:36:30.900
<v Jarek Potiuk>- Yeah, absolutely.

00:36:31.820 --> 00:36:33.820
<v Jarek Potiuk>Yeah, so maybe again, Amok can say like,

00:36:34.580 --> 00:36:37.360
<v Jarek Potiuk>I introduced it, but Amok was the one to switch

00:36:37.410 --> 00:36:38.920
<v Jarek Potiuk>to use uv at some point of time.

00:36:40.560 --> 00:36:42.720
<v Amogh Desai>- Yup, uv has been a game changer.

00:36:42.790 --> 00:36:45.100
<v Amogh Desai>I think we were using poetry before this or?

00:36:45.860 --> 00:36:47.280
<v Jarek Potiuk>- No, no, no, not even that, just pip.

00:36:48.210 --> 00:36:48.620
<v Jarek Potiuk>Just pip, just pip.

00:36:48.840 --> 00:36:49.360
<v Amogh Desai>- Just pip, right?

00:36:50.280 --> 00:36:53.220
<v Amogh Desai>It's so good. I don't even remember the last thing.

00:36:53.900 --> 00:36:55.440
<v Amogh Desai>Yeah. So, yep.

00:36:55.580 --> 00:36:58.220
<v Amogh Desai>I think the main, you know,

00:36:58.220 --> 00:37:02.060
<v Amogh Desai>game changing aspect that uv brought in was this notion of workspaces.

00:37:04.259 --> 00:37:08.680
<v Amogh Desai>It's something very, you can compare it very similar to, you know,

00:37:09.160 --> 00:37:13.240
<v Amogh Desai>a coworking space or something similar where it's a unified environment where

00:37:14.920 --> 00:37:19.020
<v Amogh Desai>multiple interconnected pieces coexist and they're very easy to manage.

00:37:19.960 --> 00:37:22.360
<v Amogh Desai>And that's something that eventually led us

00:37:22.650 --> 00:37:26.880
<v Amogh Desai>to splitting the whole repository across our distributions.

00:37:26.990 --> 00:37:29.080
<v Amogh Desai>And that's the reason you see so many TOML files.

00:37:29.800 --> 00:37:32.240
<v Amogh Desai>So everything has a PI project TOML,

00:37:32.440 --> 00:37:35.680
<v Amogh Desai>everything defines the dependency groups it needs

00:37:36.400 --> 00:37:39.700
<v Amogh Desai>and development of a particular package

00:37:40.420 --> 00:37:42.020
<v Amogh Desai>is restricted only to its dependencies.

00:37:43.360 --> 00:37:46.040
<v Amogh Desai>So you develop it, you run uv sync,

00:37:46.840 --> 00:37:50.940
<v Amogh Desai>You can run your pytest using uv,

00:37:51.260 --> 00:37:53.360
<v Amogh Desai>and everything that is supposed to run with it

00:37:53.560 --> 00:37:57.240
<v Amogh Desai>is running with it, and any bad or cross imports

00:37:57.320 --> 00:37:58.520
<v Amogh Desai>are caught really easily.

00:37:58.780 --> 00:38:02.780
<v Amogh Desai>So I think the workspace feature, at least,

00:38:02.940 --> 00:38:05.020
<v Amogh Desai>was the most important one for me,

00:38:05.880 --> 00:38:07.640
<v Amogh Desai>and obviously the speed that it brings with it.

00:38:07.820 --> 00:38:10.380
<v Amogh Desai>So that's very impressive as well.

00:38:11.140 --> 00:38:12.020
<v Michael Kennedy>It is.

00:38:12.080 --> 00:38:15.920
<v Michael Kennedy>And I think this workspace concept--

00:38:15.940 --> 00:38:16.560
<v Michael Kennedy>It's new to me.

00:38:16.640 --> 00:38:17.560
<v Michael Kennedy>I'll say it's new to me.

00:38:17.580 --> 00:38:20.180
<v Michael Kennedy>I don't know how new it is to other folks.

00:38:22.080 --> 00:38:26.120
<v Michael Kennedy>So you've got this giant monorepo.

00:38:27.020 --> 00:38:29.720
<v Michael Kennedy>And how many different, conceptually,

00:38:29.920 --> 00:38:34.540
<v Michael Kennedy>different packages or projects are in there right now?

00:38:35.160 --> 00:38:35.960
<v Jarek Potiuk>120 plus.

00:38:36.700 --> 00:38:39.440
<v Jarek Potiuk>It changes by day because Amok is doing a lot

00:38:39.580 --> 00:38:41.360
<v Jarek Potiuk>to increase the number very, very quickly

00:38:41.880 --> 00:38:44.560
<v Jarek Potiuk>because we are just now in the middle of finishing

00:38:44.580 --> 00:38:46.960
<v Jarek Potiuk>some isolation kind of restructuring.

00:38:47.540 --> 00:38:48.360
<v Jarek Potiuk>And Amog is the one that,

00:38:48.520 --> 00:38:50.900
<v Jarek Potiuk>that's why he's here also to lead the introduction

00:38:51.120 --> 00:38:52.840
<v Jarek Potiuk>of new packages that we,

00:38:52.900 --> 00:38:54.580
<v Jarek Potiuk>or new distributions that we have,

00:38:54.740 --> 00:38:57.400
<v Jarek Potiuk>like a shared libraries that we will talk about later.

00:38:58.080 --> 00:39:00.000
<v Jarek Potiuk>So we have a lot of those, yes.

00:39:00.500 --> 00:39:01.180
<v Michael Kennedy>Yeah, amazing.

00:39:01.880 --> 00:39:04.060
<v Michael Kennedy>So I think this is super important to dive into

00:39:04.360 --> 00:39:05.840
<v Michael Kennedy>and how uv makes this possible.

00:39:05.960 --> 00:39:08.200
<v Michael Kennedy>And I think you said also Hatch,

00:39:08.420 --> 00:39:09.460
<v Michael Kennedy>you talked with Ofec,

00:39:10.020 --> 00:39:11.860
<v Michael Kennedy>who runs Hatch as well about this, right?

00:39:12.320 --> 00:39:12.760
<v Jarek Potiuk>Yes, yes.

00:39:12.980 --> 00:39:14.260
<v Jarek Potiuk>Hatch is also supporting WorkSpaces,

00:39:14.340 --> 00:39:20.920
<v Jarek Potiuk>which are modeled mainly about what like after the what uv has done has done we haven't tried it yet

00:39:21.140 --> 00:39:25.660
<v Jarek Potiuk>but i've heard it's very very similar or even like you can use it as a one-to-one replacement

00:39:26.100 --> 00:39:32.020
<v Jarek Potiuk>in some cases or maybe even in all uh but generally i would love this eventually to become some kind

00:39:32.020 --> 00:39:37.360
<v Jarek Potiuk>of standard so that multiple tools are supporting this but but yes the there are a few other tools

00:39:37.480 --> 00:39:43.060
<v Jarek Potiuk>that we were considering before but uv is by far the kind of like yeah well we worked together we

00:39:42.980 --> 00:39:47.540
<v Jarek Potiuk>shaped it together with the U18. So it definitely works well.

00:39:47.600 --> 00:39:53.620
<v Michael Kennedy>Amazing. Yeah, amazing. So let me describe this a little bit. And then you all can, can actually

00:39:53.860 --> 00:39:59.700
<v Michael Kennedy>introduce it. So the idea is we've got this mono repo with a bunch of different folders for the

00:40:00.660 --> 00:40:07.460
<v Michael Kennedy>sections, right, like airflow dash CLI or CTL, and airflow dash core and so on. And you'd like to be

00:40:07.440 --> 00:40:13.120
<v Michael Kennedy>able to kind of just jump into one section and treat it as a top level project, right? It's got

00:40:13.120 --> 00:40:18.180
<v Michael Kennedy>a pyproject.toml, it's got a source file, tests, and so on. But the challenge is you can't just

00:40:18.180 --> 00:40:24.240
<v Michael Kennedy>have a bunch of disconnected pieces, like maybe Airflow core depends on five other parts of it

00:40:24.340 --> 00:40:31.240
<v Michael Kennedy>that are also themselves have their own pyproject.toml and different things. And you've got to set up,

00:40:31.520 --> 00:40:34.780
<v Michael Kennedy>you know, set up. If you jump into the Airflow core, you got to set up the environment just

00:40:34.820 --> 00:40:40.240
<v Michael Kennedy>right to be working on those other parts right it sounds um it sounds pretty tricky so how does

00:40:40.690 --> 00:40:48.300
<v Michael Kennedy>how does that work who wants to make sense of this for us yeah okay so like it works perfectly

00:40:48.730 --> 00:40:52.880
<v Jarek Potiuk>like it's super it's super simple actually you know like the whole thing about the uv is

00:40:53.080 --> 00:40:58.380
<v Jarek Potiuk>like its simplicity of the of of the of the of the not of the concept the implementation is actually

00:40:58.560 --> 00:41:02.900
<v Jarek Potiuk>quite tricky but the way how you use it is very simple you just go to the directory and run

00:41:02.880 --> 00:41:08.840
<v Jarek Potiuk>uv sync that's basically it so like this is uh this is to the directory you want to work on and

00:41:08.840 --> 00:41:14.440
<v Jarek Potiuk>it it does exactly what you would expect it to do which means that it syncs it actually updates the or

00:41:15.220 --> 00:41:19.260
<v Jarek Potiuk>recreates basically the virtual environment that you're using with all the dependencies that this

00:41:19.500 --> 00:41:26.000
<v Jarek Potiuk>particular uh distribution needs and anything that it needs uh as a transitive dependency as well

00:41:26.370 --> 00:41:30.780
<v Jarek Potiuk>so if it refers to another project project inside the workspace it will also use it from there

00:41:30.860 --> 00:41:35.120
<v Jarek Potiuk>not from like installed by pi pi so we can immediately start working on this because

00:41:35.760 --> 00:41:39.400
<v Jarek Potiuk>everything after uv sync everything is exactly as you expect for this particular

00:41:40.040 --> 00:41:44.560
<v Jarek Potiuk>subset of the repository that you work on and that's basically it this is this is all

00:41:44.710 --> 00:41:49.760
<v Jarek Potiuk>like there is nothing more basically it's like that's it it works and and you can when

00:41:49.860 --> 00:41:55.580
<v Jarek Potiuk>you're done you run uv sync py test run it will do exactly what you want so in this folder because

00:41:55.600 --> 00:41:58.200
<v Jarek Potiuk>because it will just, oh, sorry, uv run pytest.

00:41:58.280 --> 00:41:58.680
<v Jarek Potiuk>- uv run pytest.

00:41:58.680 --> 00:41:59.760
<v Jarek Potiuk>- You can do exactly what you want,

00:41:59.940 --> 00:42:02.060
<v Jarek Potiuk>because even uv run will automatically sync

00:42:03.180 --> 00:42:05.660
<v Jarek Potiuk>the virtual env very, very quickly

00:42:06.160 --> 00:42:08.060
<v Jarek Potiuk>to the one that your project needs,

00:42:08.420 --> 00:42:10.260
<v Jarek Potiuk>and then it will just run pytest

00:42:10.420 --> 00:42:11.340
<v Jarek Potiuk>in this virtual environment,

00:42:11.620 --> 00:42:13.120
<v Jarek Potiuk>and it will run all the tests in your project,

00:42:13.220 --> 00:42:14.560
<v Jarek Potiuk>and that's basically it.

00:42:15.020 --> 00:42:17.180
<v Jarek Potiuk>So it's like, conceptually for the users,

00:42:17.380 --> 00:42:19.040
<v Jarek Potiuk>it's like, you don't have to do much,

00:42:19.180 --> 00:42:20.640
<v Jarek Potiuk>just uv sync, and that's it.

00:42:24.520 --> 00:42:30.000
<v Michael Kennedy>yeah how how interesting i i think one of the big challenges here is you know how does how do

00:42:30.170 --> 00:42:37.460
<v Michael Kennedy>different parts of the project know about each other right yeah yeah you said that it uh it sim

00:42:37.780 --> 00:42:44.200
<v Michael Kennedy>links the different elements in well okay so like the basic the basic the basic kind of workspace

00:42:44.460 --> 00:42:48.580
<v Jarek Potiuk>and implementation is just a workspace definition so you have to have the finishing of workspace

00:42:48.920 --> 00:42:54.400
<v Jarek Potiuk>in the top level byproduct tom so there you have all of them listed you have links to it you have

00:42:54.420 --> 00:43:00.780
<v Jarek Potiuk>describe where they are and uv will read the PI project on from the top level and will

00:43:01.260 --> 00:43:03.520
<v Jarek Potiuk>know where to look for particular distributions.

00:43:04.190 --> 00:43:10.680
<v Jarek Potiuk>So that's the simple discovery and the way how we know that we are using it from the sources

00:43:10.900 --> 00:43:13.780
<v Jarek Potiuk>and not from the PI PI.

00:43:14.920 --> 00:43:19.840
<v Jarek Potiuk>But then like the shared libraries is like something that we added on top of it and the

00:43:19.780 --> 00:43:25.400
<v Jarek Potiuk>sim links are on the top of it and this is kind of extra innovative thing that we are doing for

00:43:25.580 --> 00:43:29.680
<v Jarek Potiuk>something else that we need but you know we can we can talk about that now or like i'm not can

00:43:29.780 --> 00:43:37.640
<v Amogh Desai>talk about that sure okay yeah yeah good yeah we can talk about it when we're talking about it

00:43:39.700 --> 00:43:41.480
<v Michael Kennedy>okay sounds good so

00:43:43.860 --> 00:43:51.180
<v Michael Kennedy>this is really cool one of the things that happens here is these different these different slices or

00:43:51.500 --> 00:43:56.640
<v Michael Kennedy>subsections of the monorepo have a pyproject.toml that pyproject.toml

00:43:56.860 --> 00:44:03.540
<v Michael Kennedy>defines its true dependencies and its dev dependencies and so on so when you go and jump

00:44:03.740 --> 00:44:12.320
<v Michael Kennedy>into a section it will uv will basically realign the virtual environment with whatever

00:44:13.440 --> 00:44:17.080
<v Michael Kennedy>dependencies are supposed to be there from those things right so that means installing stuff

00:44:17.400 --> 00:44:22.160
<v Michael Kennedy>obviously but actually what surprised me a little bit not a lot but oh yeah i guess it does do that

00:44:22.280 --> 00:44:28.820
<v Michael Kennedy>that's cool is it actually uninstalled stuff that's not explicitly put there which i can imagine

00:44:29.300 --> 00:44:35.900
<v Michael Kennedy>before that you could be like well this one part way down here depends on this weird library

00:44:37.060 --> 00:44:41.640
<v Michael Kennedy>and somehow i used to be over there then i went back to the this other piece then i came back and

00:44:41.560 --> 00:44:43.640
<v Michael Kennedy>and I forgot where that even came from.

00:44:43.720 --> 00:44:45.260
<v Michael Kennedy>Like, why is that in my virtual environment?

00:44:45.500 --> 00:44:47.080
<v Michael Kennedy>And like, how do I specify that?

00:44:47.360 --> 00:44:49.140
<v Michael Kennedy>Probably juggling that was a big problem, right?

00:44:49.260 --> 00:44:52.700
<v Michael Kennedy>This like loading and unloading dependencies

00:44:52.920 --> 00:44:55.020
<v Michael Kennedy>based on what part of the monorepo you're in.

00:44:55.020 --> 00:44:58.880
<v Michael Kennedy>And I think that actually makes it really much easier

00:44:58.940 --> 00:45:01.000
<v Michael Kennedy>to deal with like this type of code structure.

00:45:01.740 --> 00:45:02.260
<v Jarek Potiuk>Yeah, absolutely.

00:45:02.540 --> 00:45:04.300
<v Jarek Potiuk>And let me add to that one more thing

00:45:04.400 --> 00:45:06.340
<v Jarek Potiuk>because it's also not only the dependencies

00:45:06.520 --> 00:45:07.960
<v Jarek Potiuk>that you might have from somewhere else,

00:45:08.700 --> 00:45:14.940
<v Jarek Potiuk>but also it's cross dependencies between different distributions inside so for example if our flow

00:45:15.880 --> 00:45:21.040
<v Jarek Potiuk>ctl does not use airflow core if you go there and run you think you will not be able to import and

00:45:21.140 --> 00:45:26.160
<v Jarek Potiuk>use any of the source code which is in airflow core because it's not a dependency of our flow ctl

00:45:26.660 --> 00:45:30.540
<v Jarek Potiuk>so uv sync will not only uninstall the dependencies that you have but also i mean install the

00:45:30.680 --> 00:45:35.700
<v Jarek Potiuk>the source code that you have from other parts of europeo which is a fantastic thing for us and

00:45:35.580 --> 00:45:37.220
<v Jarek Potiuk>And that was exactly what was missing before,

00:45:37.440 --> 00:45:38.860
<v Jarek Potiuk>kind of isolation between those.

00:45:39.490 --> 00:45:41.660
<v Jarek Potiuk>You only actually can, from your source,

00:45:41.730 --> 00:45:45.000
<v Jarek Potiuk>you only can refer to the source code

00:45:45.090 --> 00:45:46.980
<v Jarek Potiuk>of those distribution that you depend on

00:45:47.490 --> 00:45:48.960
<v Jarek Potiuk>and nothing else from the monorepo.

00:45:49.150 --> 00:45:51.220
<v Jarek Potiuk>So this means that it's like,

00:45:51.720 --> 00:45:54.560
<v Jarek Potiuk>you can slice and dice your repository as you want.

00:45:55.120 --> 00:45:58.020
<v Jarek Potiuk>So depending on in which directory you are

00:45:58.020 --> 00:46:00.240
<v Jarek Potiuk>and when you run uv sync, you will have like subset,

00:46:00.720 --> 00:46:03.800
<v Jarek Potiuk>like the actual useful and the used subset

00:46:03.930 --> 00:46:04.660
<v Jarek Potiuk>from your repository.

00:46:04.940 --> 00:46:07.560
<v Jarek Potiuk>And it can be completely different if you go to another directory.

00:46:07.920 --> 00:46:09.000
<v Jarek Potiuk>Some of that can be overlapping.

00:46:09.280 --> 00:46:11.040
<v Jarek Potiuk>Some of that can be completely different.

00:46:11.520 --> 00:46:13.740
<v Jarek Potiuk>Depends like which dependencies are defined.

00:46:13.850 --> 00:46:16.300
<v Jarek Potiuk>And this is like, this all magically happens

00:46:16.960 --> 00:46:20.340
<v Jarek Potiuk>like by just defining the dependency in PyProject.com, nothing else.

00:46:20.480 --> 00:46:22.780
<v Jarek Potiuk>I mean, this thing will handle it for you in the workspace.

00:46:23.460 --> 00:46:27.420
<v Jarek Potiuk>This is like exactly the reason why it's so useful for development.

00:46:29.280 --> 00:46:32.520
<v Amogh Desai>- One thing, one more thing to add to that is, yeah, exactly.

00:46:32.780 --> 00:46:37.580
<v Amogh Desai>as I said, it helped us in our vision to actually, you know,

00:46:37.740 --> 00:46:42.800
<v Amogh Desai>decompose the project into multiple parts and avoid the classic

00:46:43.300 --> 00:46:44.700
<v Amogh Desai>problem of coupling,

00:46:45.910 --> 00:46:49.320
<v Amogh Desai>which every Mono repo faces at some point in their life cycle,

00:46:49.740 --> 00:46:52.740
<v Amogh Desai>because everything is out there. Why don't we just, you know,

00:46:53.260 --> 00:46:57.500
<v Amogh Desai>have code leaks all over the place. So this helps us prevent that.

00:46:57.720 --> 00:47:01.580
<v Amogh Desai>And I cannot imagine a time how we did it earlier before uv.

00:47:02.420 --> 00:47:04.500
<v Amogh Desai>I don't know if we did it, but if we did it,

00:47:04.500 --> 00:47:06.500
<v Amogh Desai>it would have been a really tough thing to do.

00:47:07.240 --> 00:47:07.420
<v Michael Kennedy>Yeah.

00:47:08.000 --> 00:47:09.820
<v Michael Kennedy>There's a bunch of tools that you can,

00:47:10.700 --> 00:47:12.440
<v Michael Kennedy>like linters and code analysis,

00:47:12.580 --> 00:47:15.060
<v Michael Kennedy>things you can run on your code that breaks down.

00:47:15.540 --> 00:47:17.400
<v Michael Kennedy>For these different modules and these layers,

00:47:17.740 --> 00:47:20.380
<v Michael Kennedy>here's like a directed graph of how this thing,

00:47:21.020 --> 00:47:22.440
<v Michael Kennedy>and you can set up rules to say,

00:47:22.540 --> 00:47:24.280
<v Michael Kennedy>this should never cross that boundary,

00:47:24.820 --> 00:47:29.680
<v Michael Kennedy>but these are just very vague things.

00:47:29.940 --> 00:47:35.580
<v Michael Kennedy>And this setup actually makes it so it's not accessible to your code if you didn't say it

00:47:35.680 --> 00:47:35.860
<v Michael Kennedy>should be.

00:47:36.360 --> 00:47:36.480
<v Jarek Potiuk>Yes.

00:47:36.940 --> 00:47:37.040
<v Jarek Potiuk>Yes.

00:47:37.110 --> 00:47:42.200
<v Jarek Potiuk>So it's just built in exactly the definition of your distribution, which you anyhow have

00:47:42.340 --> 00:47:45.420
<v Jarek Potiuk>to do because you have to define what the dependencies are.

00:47:45.980 --> 00:47:47.540
<v Jarek Potiuk>And yes, we did something like that before.

00:47:47.670 --> 00:47:49.960
<v Jarek Potiuk>So we got a number of rough rules or whatever.

00:47:50.520 --> 00:47:51.840
<v Jarek Potiuk>Don't import here.

00:47:53.000 --> 00:47:56.960
<v Jarek Potiuk>We still have them for shared libraries, which we can talk about now, because I think this

00:47:56.900 --> 00:48:02.980
<v Jarek Potiuk>is an important modification of the of the concept so we do do have some automated check for uh

00:48:03.260 --> 00:48:10.340
<v Jarek Potiuk>quality and for imports uh with prague our precomit hook implementation but but before that it was

00:48:10.460 --> 00:48:16.900
<v Jarek Potiuk>just completely completely uh like handwritten and unmaintainable people will not we're not actually

00:48:17.240 --> 00:48:23.359
<v Jarek Potiuk>updating it with all the distributions you couldn't really you know follow uh when things change with

00:48:23.380 --> 00:48:28.960
<v Jarek Potiuk>with my project tom being the for each distribution being the single source of truth you don't have to

00:48:29.020 --> 00:48:33.880
<v Jarek Potiuk>do anything because the dependency is declared there and this is like the best part of of

00:48:34.520 --> 00:48:40.000
<v Jarek Potiuk>uv understanding that and and doing everything that is like reasonable in this case yeah

00:48:42.160 --> 00:48:51.680
<v Michael Kennedy>yeah yeah so the other major tool involved here was prick which it's a pre-commit framework for

00:48:51.700 --> 00:48:58.120
<v Michael Kennedy>running hooks many languages but especially python relevant here written in rust so it pairs well

00:48:58.250 --> 00:49:04.680
<v Jarek Potiuk>with uv i suppose oh yeah it was inspired by uv as well and joe was mentioning mentions that

00:49:06.180 --> 00:49:14.960
<v Michael Kennedy>he was actually contributing to uv yeah cool all right so where's preck how's preck show up here

00:49:15.450 --> 00:49:18.800
<v Michael Kennedy>uh among i feel like this is leading towards what you were hinting at earlier

00:49:19.740 --> 00:49:29.960
<v Amogh Desai>yeah i'm okay yeah yep so i think it started with uh it was called pre-flight earlier i believe

00:49:30.420 --> 00:49:35.360
<v Jarek Potiuk>that's the name preferably git that was the original name oh yeah it was like terrible

00:49:37.440 --> 00:49:43.200
<v Amogh Desai>it's a new name uh preq so yep this allows us to do things which uh

00:49:44.520 --> 00:49:52.740
<v Amogh Desai>pre-commit did not do or you know did not accept as suggestions so one certain thing that preck

00:49:52.840 --> 00:50:00.880
<v Amogh Desai>offers is obviously it's written in rust so speed is the obvious uh advantage that we get but apart

00:50:00.940 --> 00:50:05.980
<v Amogh Desai>from that we also get this notion of it pairing well with uv in terms of modularized hooks

00:50:06.800 --> 00:50:13.200
<v Amogh Desai>earlier we had all the hooks in one place in that in the top level pre-commit yaml right and

00:50:14.060 --> 00:50:22.840
<v Amogh Desai>it was it was a big fight it was you can imagine so yeah so this break allowed us to

00:50:23.670 --> 00:50:30.240
<v Amogh Desai>break again you know it it consumed the concept of workspaces here i would say so it allowed you to

00:50:30.680 --> 00:50:38.480
<v Amogh Desai>define pre-commit hooks or preq hooks within a module itself and this paired well with uv in

00:50:38.500 --> 00:50:41.660
<v Amogh Desai>in the sense that when you have to run hooks

00:50:41.980 --> 00:50:43.820
<v Amogh Desai>that are bound to a certain distribution,

00:50:44.400 --> 00:50:48.640
<v Amogh Desai>all you have to do is check in into the, you know,

00:50:48.670 --> 00:50:50.400
<v Amogh Desai>the sub module and just do a preck run.

00:50:50.450 --> 00:50:54.060
<v Amogh Desai>It will run the relevant hooks for that particular module.

00:50:54.700 --> 00:50:58.540
<v Amogh Desai>And the other thing that I really love about preck

00:50:58.620 --> 00:51:03.680
<v Amogh Desai>is auto-completion, which is not something pre-commit had.

00:51:03.750 --> 00:51:06.800
<v Amogh Desai>So you can imagine that something fails in the CI,

00:51:06.980 --> 00:51:13.860
<v Amogh Desai>have to copy that and copy the ID and try to kind of backtrack it in your repo as to which one is

00:51:13.900 --> 00:51:20.200
<v Amogh Desai>failing. So it used to be a nightmare, but now with the dApp completion, it's amazing.

00:51:20.700 --> 00:51:24.680
<v Michael Kennedy>Nice. Are you talking about like shell autocomplete integration?

00:51:24.680 --> 00:51:24.800
<v Michael Kennedy>Yes.

00:51:25.540 --> 00:51:28.260
<v Michael Kennedy>Yeah. Yeah. So, okay. Nice. I've seen...

00:51:28.260 --> 00:51:31.160
<v Jarek Potiuk>So I have some story about that very short one. So like,

00:51:31.560 --> 00:51:36.900
<v Jarek Potiuk>we actually tried to get autocompletion for hook names with pre-commit, which was the predecessor.

00:51:36.900 --> 00:51:43.680
<v Jarek Potiuk>of Prac, like Prac was largely based on Pracomit, but somehow the author of it didn't accept

00:51:44.020 --> 00:51:50.420
<v Jarek Potiuk>even idea of us contributing it or actually had some very, very excessive expectations for that.

00:51:51.120 --> 00:51:55.200
<v Jarek Potiuk>And we, you know, discussed and like, there were like other people were also trying to

00:51:55.640 --> 00:52:01.460
<v Jarek Potiuk>convince the author to do that, but they refused, he refused basically, and refused to accept

00:52:01.540 --> 00:52:07.200
<v Jarek Potiuk>contributions even uh so when when we spoke to joe that was like completely different stories like

00:52:07.480 --> 00:52:13.060
<v Jarek Potiuk>we need that and next day it was there like it's like completely different approach so so this

00:52:13.140 --> 00:52:17.800
<v Jarek Potiuk>is uh and then we said like we need workspaces and like a few weeks later because it took a little

00:52:17.940 --> 00:52:22.220
<v Jarek Potiuk>bit of time it was there and we worked together and we tested that and like i raised i don't know

00:52:22.220 --> 00:52:28.740
<v Jarek Potiuk>how many issues in the initial kind of pre-release version when when we wanted to use it so so the

00:52:28.760 --> 00:52:33.800
<v Jarek Potiuk>i think the collaboration and being you know working together listening to your users and be

00:52:33.920 --> 00:52:39.040
<v Jarek Potiuk>responding to them and and actually working as an open source maintainers together this this

00:52:39.220 --> 00:52:43.700
<v Jarek Potiuk>actually worked perfectly well here both both in uv and and in practice and this is why we love

00:52:43.920 --> 00:52:49.240
<v Jarek Potiuk>prague actually because because we know we can rely if something is not working that it's gonna be

00:52:49.320 --> 00:52:56.560
<v Jarek Potiuk>like we can discuss and either submit a fix or or you know joe will do this or even like lots of

00:52:56.360 --> 00:53:01.440
<v Jarek Potiuk>other people can do it because i think the there was uh there was a few features that we wanted

00:53:01.620 --> 00:53:06.820
<v Jarek Potiuk>and somebody else implemented it and that wasn't joe they contributed to crack because of this

00:53:06.880 --> 00:53:13.780
<v Jarek Potiuk>openness and you know being able to accept the needs of the users so that was yeah that was very

00:53:13.900 --> 00:53:18.980
<v Amogh Desai>very important part like why we moved to crack yeah i think airflow was also one of the initial

00:53:19.300 --> 00:53:25.620
<v Amogh Desai>case studies for break it's a project of that scale and if you kind of satisfy that project's

00:53:25.720 --> 00:53:33.520
<v Amogh Desai>needs you are you're pretty good with most use cases i think that's exactly both like and uv as

00:53:34.500 --> 00:53:39.420
<v Michael Kennedy>yeah right there at the top of the prec repo it says although prec is pretty new it's already

00:53:39.480 --> 00:53:45.460
<v Michael Kennedy>powering real projects you know little things like c python apache airflow and fast api so yeah you

00:53:45.460 --> 00:53:51.540
<v Jarek Potiuk>know i i know who gov and kamerate from uh release manager of python uh so we met at for them as

00:53:51.480 --> 00:53:56.000
<v Jarek Potiuk>well. And like he was actually listening to our preg discussion and he converted, you know,

00:53:56.540 --> 00:54:00.980
<v Jarek Potiuk>cpython to use preg because of the of the needs they had. So like, it was all about, you know,

00:54:01.100 --> 00:54:04.500
<v Jarek Potiuk>people talking to each other, word of mouth and things like that.

00:54:05.240 --> 00:54:12.780
<v Michael Kennedy>Yeah. You know, there's a feature listed here that just makes me jealous. One of the features

00:54:12.960 --> 00:54:17.540
<v Michael Kennedy>of preg is a single binary with no dependencies that doesn't require Python or any other runtime

00:54:17.560 --> 00:54:24.680
<v Michael Kennedy>to be installed. Like, how incredible would it be with Python if we had a, you know, a Python, dash,

00:54:24.870 --> 00:54:30.300
<v Michael Kennedy>dash, build app or something, you know what I mean, you can put it at your thing and you get something

00:54:30.600 --> 00:54:35.940
<v Michael Kennedy>you could distribute. I know uv solves a lot, but you still got to have uv installed. And then you

00:54:35.970 --> 00:54:41.520
<v Michael Kennedy>know, like this, that is a huge advantage of things like Rust and go and some other languages.

00:54:42.500 --> 00:54:45.000
<v Jarek Potiuk>It's both good and bad in some cases.

00:54:45.140 --> 00:54:46.900
<v Jarek Potiuk>So it's like there are always trade-offs.

00:54:47.140 --> 00:54:49.160
<v Jarek Potiuk>It's different choice made by Python here.

00:54:49.600 --> 00:54:52.860
<v Jarek Potiuk>I don't think it's like the best choice for Python.

00:54:53.100 --> 00:54:54.440
<v Jarek Potiuk>I think Python being script language,

00:54:55.360 --> 00:54:57.480
<v Jarek Potiuk>it's okay to have, you know, like dependencies

00:54:57.940 --> 00:54:59.920
<v Jarek Potiuk>and especially like inline script metadata

00:55:00.600 --> 00:55:02.960
<v Jarek Potiuk>almost did it because you just, you know,

00:55:03.420 --> 00:55:04.900
<v Jarek Potiuk>can install stuff and uv also,

00:55:05.280 --> 00:55:07.660
<v Jarek Potiuk>and the kind of tooling is also doing all the stuff

00:55:07.820 --> 00:55:09.640
<v Jarek Potiuk>like uv install or uv tool install,

00:55:11.080 --> 00:55:13.780
<v Jarek Potiuk>whatever, and it would not only install the project,

00:55:14.320 --> 00:55:15.780
<v Jarek Potiuk>its dependencies, but also install Python

00:55:16.000 --> 00:55:17.320
<v Jarek Potiuk>that is needed to run it.

00:55:17.440 --> 00:55:20.100
<v Jarek Potiuk>So like all this is really a matter of two weeks

00:55:20.330 --> 00:55:22.340
<v Jarek Potiuk>and it has improved dramatically over the last few years.

00:55:22.340 --> 00:55:23.220
<v Michael Kennedy>- It definitely has.

00:55:24.060 --> 00:55:27.000
<v Michael Kennedy>Yeah, I was pining for an option,

00:55:27.240 --> 00:55:29.900
<v Michael Kennedy>not a only binary thing.

00:55:30.600 --> 00:55:32.120
<v Michael Kennedy>All right, so one thing I actually wanna talk about,

00:55:32.240 --> 00:55:34.720
<v Michael Kennedy>going back to this workspaces thing real quick is,

00:55:36.660 --> 00:55:43.800
<v Michael Kennedy>what does it look like from a ide or editor experience to work on this all right like

00:55:44.520 --> 00:55:51.200
<v Michael Kennedy>you've got pyjarm projects you've got maybe vs code workspaces where you can pull in different

00:55:51.420 --> 00:56:00.800
<v Amogh Desai>pieces how do you all manage that i'm working yeah so i cannot talk for vs code i'm a pyjarm user

00:56:00.820 --> 00:56:09.940
<v Amogh Desai>here, but we had to do a little bit of hacking, I would say, or more like a helper script for the

00:56:10.180 --> 00:56:18.140
<v Amogh Desai>IDs, right? Because so we have a ID helper script right in the repo and we recommend the users to

00:56:18.140 --> 00:56:26.320
<v Amogh Desai>run it so that the ID knows what is where in terms of maintaining things, right? Because in normal

00:56:26.340 --> 00:56:33.420
<v Amogh Desai>projects, there's usually just one source, one test at the top level, but as 120 plus and

00:56:34.520 --> 00:56:39.140
<v Amogh Desai>the helper script is, it does a pretty simple thing. It just auto discovers all the packages

00:56:39.210 --> 00:56:48.600
<v Amogh Desai>in the monorepo and adds, there's a, so IntelliJ and PyCharm both have a dot idea within each,

00:56:49.790 --> 00:56:54.340
<v Amogh Desai>a hidden folder within each of the projects that it opens and it has a,

00:56:55.060 --> 00:57:01.160
<v Amogh Desai>and it supports XML like format for IML where you can define certain things. So this essentially

00:57:01.500 --> 00:57:07.820
<v Amogh Desai>does a very simple thing. It just for each package, it adds the module slash source as the source

00:57:07.980 --> 00:57:14.940
<v Amogh Desai>root and the module slash tests are the test. So it's as if you went through all 120 things

00:57:14.970 --> 00:57:18.360
<v Michael Kennedy>and right clicked and said mark as sources root or something like that. Yeah. You wouldn't want

00:57:18.180 --> 00:57:21.960
<v Amogh Desai>to do that. We did that actually. We did that for some time.

00:57:22.520 --> 00:57:22.960
<v Amogh Desai>- Initially.

00:57:25.780 --> 00:57:30.300
<v Jarek Potiuk>Yeah, we had this PyCharm script and then we have the same approach for VS Code. So we have another

00:57:30.500 --> 00:57:35.240
<v Jarek Potiuk>script for VS Code as well, which was contributed by someone who uses VS Code because either me or

00:57:35.720 --> 00:57:44.060
<v Jarek Potiuk>Amog are VS Code users. But communities also, and somebody said, "Okay, I'll do it." And there it was.

00:57:44.100 --> 00:57:48.840
<v Jarek Potiuk>and they tested it and you know like that's that was super cool actually so so yeah it works well

00:57:49.240 --> 00:57:54.720
<v Jarek Potiuk>also the you know a little bit of words uh i would probably we don't talk we won't talk too much

00:57:55.360 --> 00:58:00.560
<v Jarek Potiuk>about like the we don't have too much time but the shared libraries concept a little bit might maybe

00:58:01.100 --> 00:58:06.500
<v Jarek Potiuk>it's the right time to introduce the yeah yeah because we like one thing that amov mentioned

00:58:06.740 --> 00:58:12.160
<v Jarek Potiuk>is like the uh we had we solved this coupling problem but also we wanted to solve the dry

00:58:12.180 --> 00:58:17.540
<v Jarek Potiuk>problem. And those two are always kind of mixture, like you get dry and then you get more dry and

00:58:17.660 --> 00:58:22.540
<v Jarek Potiuk>less coupling and like, like more dry and more coupling and like, all these things are complex

00:58:22.720 --> 00:58:27.960
<v Michael Kennedy>when you have lots of code. Dry being the architectural philosophy of do not repeat

00:58:28.140 --> 00:58:32.800
<v Michael Kennedy>yourself. But if you're not repeating yourself, every, everything where if it exists somewhere,

00:58:33.000 --> 00:58:37.100
<v Michael Kennedy>everything's got to depend on that somewhere. And it starts to become more linked together, right?

00:58:37.540 --> 00:58:44.060
<v Jarek Potiuk>precisely so so it's a little bit of like uh uh you know it can have it too like the the

00:58:44.300 --> 00:58:49.000
<v Jarek Potiuk>we want to have dry code and not to repeat it for like common utilities like logging

00:58:49.600 --> 00:58:53.480
<v Jarek Potiuk>configuration whatever all the things that that are kind of common between all the different

00:58:53.640 --> 00:58:59.240
<v Jarek Potiuk>distributions but also we didn't want to depend on a single version of those because if we do

00:58:59.820 --> 00:59:04.000
<v Jarek Potiuk>then it means that we have to make sure that the backwards compatibility is maintained because like

00:59:04.020 --> 00:59:08.120
<v Jarek Potiuk>when we install different version of different distributions coming from different time

00:59:08.940 --> 00:59:14.540
<v Jarek Potiuk>of repository they might use different version of those search libraries and like how to make sure

00:59:14.620 --> 00:59:18.580
<v Jarek Potiuk>that they don't do not have breaking changes and stuff like so this is all the whole level

00:59:18.590 --> 00:59:23.740
<v Jarek Potiuk>of complexity between like how to manage the dependencies there and manage versions especially

00:59:24.020 --> 00:59:29.600
<v Jarek Potiuk>manage the backwards compatibility so we figure out that with some very simple approach we tried

00:59:29.620 --> 00:59:35.160
<v Jarek Potiuk>few different approaches but like one of the approaches was using the vendor ink library from

00:59:35.320 --> 00:59:42.640
<v Jarek Potiuk>pip and from byton uh not from people from pip and the second one and that's the one we came up we

00:59:42.690 --> 00:59:47.200
<v Jarek Potiuk>we finally implemented with like using sim links to share the code between different distributions

00:59:47.490 --> 00:59:52.880
<v Jarek Potiuk>and that's a very innovative approach that i hope uh will make it into some kind of standard

00:59:53.160 --> 00:59:58.000
<v Jarek Potiuk>eventually so like we came with this approach where we actually have cake and eat it too like

00:59:58.020 --> 01:00:02.740
<v Jarek Potiuk>which is like pretty amazing if you fought with like for years with this kind of

01:00:03.360 --> 01:00:08.720
<v Jarek Potiuk>common dependency issues that and and and backwards compatibility so in our case like the symlink

01:00:08.880 --> 01:00:14.880
<v Jarek Potiuk>approach we have and it needs some preq kind of pre-processing of by project tom so some parts of

01:00:14.940 --> 01:00:19.720
<v Jarek Potiuk>the by project tom are generated to make it actually work but this is all automated with

01:00:19.920 --> 01:00:24.240
<v Jarek Potiuk>preq which is like you don't have to think about that even and once we do that and once we create

01:00:24.260 --> 01:00:30.260
<v Jarek Potiuk>some similar sim links between different parts of code like one library one distribution is

01:00:30.360 --> 01:00:35.340
<v Jarek Potiuk>sim linking code from the shared distribution the end result is that this code gets automatically

01:00:35.780 --> 01:00:41.300
<v Jarek Potiuk>vendored in during the building of the package which means that we actually have the same library

01:00:41.520 --> 01:00:46.920
<v Jarek Potiuk>in different package in different version in different distributions so distribution released

01:00:47.520 --> 01:00:53.600
<v Jarek Potiuk>week ago will have a shared configuration from a week ago but this another distribution will have

01:00:53.620 --> 01:00:59.280
<v Jarek Potiuk>the same shared configuration code from today if it's released today and we can install them

01:00:59.520 --> 01:01:06.200
<v Jarek Potiuk>together and all of them have effectively uh like if they had a different version of the

01:01:06.360 --> 01:01:13.400
<v Michael Kennedy>same library installed i see it's as if the airflow dash ctl said it had a dependency on

01:01:13.600 --> 01:01:18.840
<v Michael Kennedy>core and it pinned that version to something but a different part of the repo pinned it to a

01:01:18.940 --> 01:01:22.980
<v Michael Kennedy>different version right they can both kind of coexist that's but it's actually all within the

01:01:22.900 --> 01:01:28.800
<v Michael Kennedy>same code file. That's insane. Okay. And this is like largely like, it's nothing new. It's largely

01:01:30.380 --> 01:01:35.940
<v Jarek Potiuk>inspired by how the, you know, libraries work in C and like traditional kind of building code. Like

01:01:35.940 --> 01:01:41.880
<v Jarek Potiuk>you have dynamic libraries and static libraries. So this is like essentially equivalent of static

01:01:42.000 --> 01:01:47.280
<v Jarek Potiuk>static libraries where you take the code of the version that you compile the stuff in and put it

01:01:47.220 --> 01:01:52.960
<v Jarek Potiuk>inside the final binary and then it results like in rust the kind of single binary thing so

01:01:53.200 --> 01:01:59.120
<v Jarek Potiuk>it's a little bit like so this we have a little bit of this single binary by doing that in like

01:01:59.240 --> 01:02:03.600
<v Jarek Potiuk>in the sense that we automatically vendor in all the you know shared dependencies that we have

01:02:04.220 --> 01:02:10.820
<v Jarek Potiuk>in the same distribution so so it's it's kind of hybrid but it's always like it's also like so rust

01:02:10.880 --> 01:02:14.900
<v Jarek Potiuk>is a little bit too far because everything is single binary in our case we have a bit of both

01:02:14.900 --> 01:02:20.360
<v Jarek Potiuk>like we can use libraries dynamically but we can also embed libraries as shared inside the

01:02:21.140 --> 01:02:33.180
<v Michael Kennedy>single distribution. That's very cool. Amogh? Sounds like you were instrumental in this part.

01:02:34.450 --> 01:02:44.860
<v Amogh Desai>Yeah, so that's the nice thing about the approach that was chosen, right? We all came together as a

01:02:44.980 --> 01:02:50.360
<v Amogh Desai>we had one email uh devilish discussion one fine day that hey we want to achieve something like this

01:02:51.080 --> 01:02:57.420
<v Amogh Desai>which more or less was a uh was something everyone agreed upon so people started chiming in and we

01:02:57.480 --> 01:03:01.920
<v Amogh Desai>started trying different things out the first one obviously using the rendering tool from

01:03:02.650 --> 01:03:08.980
<v Amogh Desai>uh somebody did a poc on that but it felt like it's going to be difficult to achieve that over

01:03:08.880 --> 01:03:13.920
<v Amogh Desai>long term and and also it would it could be brittle so Jarek came up with this particular

01:03:14.940 --> 01:03:20.640
<v Amogh Desai>option with sim links which again was discussed within the community few of us a few of us picked

01:03:20.640 --> 01:03:26.980
<v Amogh Desai>it the picked this pr up passed it locally played around and gave the feedback so i don't think

01:03:27.050 --> 01:03:34.060
<v Amogh Desai>this would be possible with ai in in the sense that this has never been done before yeah so some

01:03:34.120 --> 01:03:40.140
<v Amogh Desai>something like this where a community comes together and solves a rather difficult problem

01:03:40.440 --> 01:03:47.680
<v Amogh Desai>is something that makes me really happy and also something that all of us are working towards a

01:03:47.720 --> 01:03:55.860
<v Amogh Desai>common goal while while also bound by our corporate hats right is something that is again really nice

01:03:55.920 --> 01:04:04.660
<v Amogh Desai>to see we have about how 11 i think at this point we have about 11 to 12 shared libraries where

01:04:05.420 --> 01:04:12.700
<v Amogh Desai>the main notion here is to reimagine airflow as a independent server and more like a control plane

01:04:12.700 --> 01:04:19.240
<v Amogh Desai>and execution plane what we did with airflow three and this shared libraries is helping us achieve

01:04:20.560 --> 01:04:27.020
<v Amogh Desai>that model. And we have about 11 to 12 of them. And I think a few more coming very soon. But yeah,

01:04:28.860 --> 01:04:32.720
<v Amogh Desai>it's been nice working on the shared libraries. It's been great.

01:04:33.300 --> 01:04:38.200
<v Michael Kennedy>That's cool. Is this something that people can take and adopt into their monorepo if they want

01:04:38.200 --> 01:04:44.540
<v Jarek Potiuk>to live that life? Absolutely. It's really like one or two kind of

01:04:44.400 --> 01:04:46.840
<v Jarek Potiuk>of preq hooks, which are maintaining the consistency.

01:04:47.590 --> 01:04:51.080
<v Jarek Potiuk>And like, so that you don't forget to add this sim link here

01:04:51.240 --> 01:04:54.480
<v Jarek Potiuk>and that kind of PyProjectTOM definition here

01:04:54.700 --> 01:04:57.560
<v Jarek Potiuk>and the, or that hatch definition for the hatch link

01:04:57.820 --> 01:05:01.320
<v Jarek Potiuk>to actually embed your sim linked code

01:05:01.490 --> 01:05:02.660
<v Jarek Potiuk>into the final distribution.

01:05:03.000 --> 01:05:04.380
<v Jarek Potiuk>So like there are like a few pieces

01:05:04.580 --> 01:05:07.420
<v Jarek Potiuk>that have to be put together from existing libraries.

01:05:08.320 --> 01:05:09.180
<v Jarek Potiuk>So that's basically it.

01:05:09.210 --> 01:05:11.340
<v Jarek Potiuk>And once you do it, it's just, those are,

01:05:11.730 --> 01:05:13.840
<v Jarek Potiuk>the funny thing is like those shared libraries

01:05:13.860 --> 01:05:19.760
<v Jarek Potiuk>just standalone distributions you can actually build them separately as a library as well we could

01:05:19.920 --> 01:05:24.560
<v Jarek Potiuk>we could potentially even you know like just use them as library as well no problem whatsoever

01:05:25.000 --> 01:05:29.880
<v Jarek Potiuk>because they are just standard plain distributions or any other we just happen to take the source code

01:05:29.980 --> 01:05:36.180
<v Jarek Potiuk>of it and then embed it in into into the target distribution that wants to use it rather than you

01:05:36.200 --> 01:05:41.120
<v Jarek Potiuk>know link to it by dependency so that's basically other than that it's it's it's a kind of

01:05:41.140 --> 01:05:46.320
<v Jarek Potiuk>completely standard library and uh or standard distribution and one one more thing that is really

01:05:46.400 --> 01:05:52.440
<v Jarek Potiuk>important to add here is like this also has a side effect but i think a very nice one and ammo can

01:05:52.560 --> 01:05:57.380
<v Jarek Potiuk>confirm that because he has been doing a lot of that is like we actually come up with like way

01:05:57.560 --> 01:06:03.020
<v Jarek Potiuk>better internal architecture because of that because a lot of those that the shared libraries

01:06:03.180 --> 01:06:08.000
<v Jarek Potiuk>they depended on each other sometimes in a circular fashion sometimes it really depended

01:06:08.020 --> 01:06:10.060
<v Jarek Potiuk>and like which import you did first, like what happened,

01:06:10.260 --> 01:06:11.480
<v Jarek Potiuk>like what was initialized?

01:06:11.960 --> 01:06:13.920
<v Jarek Potiuk>And it was like complete spaghetti of dependencies

01:06:14.360 --> 01:06:17.500
<v Jarek Potiuk>between generally independent pieces of functionality.

01:06:18.240 --> 01:06:20.140
<v Jarek Potiuk>Right now by having shared libraries,

01:06:20.860 --> 01:06:24.380
<v Jarek Potiuk>we are actually forcing ourselves to make them isolated

01:06:24.800 --> 01:06:28.380
<v Jarek Potiuk>and we are changing the way how we initialize them.

01:06:28.420 --> 01:06:30.540
<v Jarek Potiuk>For example, we are injecting all the configuration

01:06:30.940 --> 01:06:32.900
<v Jarek Potiuk>rather than using them from inside the library

01:06:33.380 --> 01:06:35.360
<v Jarek Potiuk>because like configuration library is another library,

01:06:35.400 --> 01:06:37.320
<v Jarek Potiuk>so you don't want to depend on the other library.

01:06:37.560 --> 01:06:39.660
<v Jarek Potiuk>So it's really nice.

01:06:39.820 --> 01:06:46.040
<v Jarek Potiuk>I think it comes, the result is that really the architecture of Airflow internally is

01:06:46.160 --> 01:06:47.460
<v Jarek Potiuk>so much better because of that.

01:06:47.680 --> 01:06:53.660
<v Jarek Potiuk>So less surprises and explicit initialization is like something that we'll have to do rather

01:06:53.680 --> 01:07:00.200
<v Jarek Potiuk>than implicit initialization during imports, which has always been plaguing as a big issue.

01:07:02.320 --> 01:07:21.180
<v Amogh Desai>Certainly. It also allows you to imagine each component having an entry point, per se, where you have an initial starting point and it initializes everything it needs by injecting and calling certain factories, which makes a very clean for anyone visiting the project also.

01:07:21.560 --> 01:07:23.660
<v Amogh Desai>they look at something and they know the entry point very clearly.

01:07:24.180 --> 01:07:26.640
<v Amogh Desai>But here, this is how it starts, this is what it initializes.

01:07:27.660 --> 01:07:34.200
<v Amogh Desai>Reminds me of Golang or Java projects where they have a nice main where in Python,

01:07:35.200 --> 01:07:38.720
<v Amogh Desai>Python it's not really the same way, but yeah.

01:07:39.480 --> 01:07:40.500
<v Michael Kennedy>Yeah, very cool.

01:07:42.180 --> 01:07:45.280
<v Michael Kennedy>All right, well, I think that's about it for all the time we have.

01:07:46.580 --> 01:07:50.600
<v Michael Kennedy>I guess let's close it out with one final thought here.

01:07:50.610 --> 01:07:54.080
<v Michael Kennedy>It's just people who are maybe inspired by your design,

01:07:54.660 --> 01:07:56.860
<v Michael Kennedy>by the way you put together Airflow

01:07:56.930 --> 01:08:00.460
<v Michael Kennedy>and this monorepo concept, especially Python people,

01:08:00.780 --> 01:08:01.900
<v Michael Kennedy>what do you say to them?

01:08:02.690 --> 01:08:03.280
<v Michael Kennedy>Final thoughts here.

01:08:04.660 --> 01:08:06.780
<v Jarek Potiuk>- Final thoughts, just do it.

01:08:06.790 --> 01:08:10.840
<v Jarek Potiuk>I mean, like I initially, there was always discussion.

01:08:10.950 --> 01:08:12.720
<v Jarek Potiuk>Like we had lots of discussions internally,

01:08:12.890 --> 01:08:14.760
<v Jarek Potiuk>even some of the PM's members in Airflow,

01:08:14.920 --> 01:08:19.620
<v Jarek Potiuk>they let's split the repository into smaller one like let's make more of them because it's going

01:08:19.620 --> 01:08:26.100
<v Jarek Potiuk>to make things easier i was always the monorepo fan and and i made a lot of work to make it possible

01:08:26.400 --> 01:08:30.900
<v Jarek Potiuk>but that was a very very difficult thing it's changed so like the reasons why you would

01:08:31.020 --> 01:08:36.700
<v Jarek Potiuk>like to have multiple repos are gone now if you're using the right tooling and only the benefits or

01:08:36.940 --> 01:08:41.060
<v Jarek Potiuk>mostly the benefits from having it in one place where you can test everything together and work

01:08:41.100 --> 01:08:48.060
<v Jarek Potiuk>on it together remain all the rest is basically gone so for me uh like uh the discussion

01:08:48.080 --> 01:09:00.580
<v Jarek Potiuk>on the repo versus multi-repo is already solved nice yeah just do it uh we it's it's not even uh

01:09:01.060 --> 01:09:07.779
<v Amogh Desai>so personally i've been using uh using the readme that we have present in the

01:09:08.680 --> 01:09:15.359
<v Amogh Desai>shared libraries as a context for my uh id so it's it's turning out to be very nice uh for the

01:09:15.880 --> 01:09:21.220
<v Amogh Desai>shared library split for example all all i have to do is just provide it the context and tell

01:09:21.240 --> 01:09:26.920
<v Amogh Desai>it hey just just construct the structure for me and i can do everything else so it's that easy

01:09:27.839 --> 01:09:33.700
<v Amogh Desai>we have all the things in place we are in the right era to do it so just just do it okay

01:09:34.859 --> 01:09:44.480
<v Michael Kennedy>very inspiring thank you for being here awesome for this look inside and it's apache airflow it's

01:09:44.480 --> 01:09:50.680
<v Michael Kennedy>on github people can go look and see it's not just a talking vaguely about some internal project right

01:09:50.839 --> 01:09:56.740
<v Michael Kennedy>so people can go check it out yeah all right see you later thanks thank you thanks bye

